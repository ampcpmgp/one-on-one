var Ge=Object.defineProperty,Je=Object.defineProperties;var Xe=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable;var ye=(t,e,n)=>e in t?Ge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ve=(t,e)=>{for(var n in e||(e={}))Be.call(e,n)&&ye(t,n,e[n]);if(we)for(var n of we(e))Ke.call(e,n)&&ye(t,n,e[n]);return t},be=(t,e)=>Je(t,Xe(e));function m(){}function Oe(t,e){for(const n in e)t[n]=e[n];return t}function Le(t){return t()}function $e(){return Object.create(null)}function M(t){t.forEach(Le)}function V(t){return typeof t=="function"}function L(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Qe(t){return Object.keys(t).length===0}function de(t,...e){if(t==null)return m;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Re(t){let e;return de(t,n=>e=n)(),e}function oe(t,e,n){t.$$.on_destroy.push(de(e,n))}function re(t){return t&&V(t.destroy)?t.destroy:m}function z(t,e){t.appendChild(e)}function p(t,e,n){t.insertBefore(e,n||null)}function _(t){t.parentNode.removeChild(t)}function b(t){return document.createElement(t)}function De(t){return document.createTextNode(t)}function x(){return De(" ")}function he(){return De("")}function U(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function W(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ze(t){return Array.from(t.childNodes)}function Ce(t,e){t.value=e==null?"":e}function et(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const c=document.createEvent("CustomEvent");return c.initCustomEvent(t,n,i,e),c}let Y;function F(t){Y=t}function K(){if(!Y)throw new Error("Function called outside component initialization");return Y}function Ie(t){K().$$.on_mount.push(t)}function tt(t){K().$$.after_update.push(t)}function nt(t){K().$$.on_destroy.push(t)}function st(){const t=K();return(e,n,{cancelable:i=!1}={})=>{const c=t.$$.callbacks[e];if(c){const r=et(e,n,{cancelable:i});return c.slice().forEach(d=>{d.call(t,r)}),!r.defaultPrevented}return!0}}function ce(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(i=>i.call(this,e))}const q=[],xe=[],X=[],ke=[],Te=Promise.resolve();let ae=!1;function Ae(){ae||(ae=!0,Te.then(je))}function Pe(){return Ae(),Te}function le(t){X.push(t)}const ie=new Set;let J=0;function je(){const t=Y;do{for(;J<q.length;){const e=q[J];J++,F(e),it(e.$$)}for(F(null),q.length=0,J=0;xe.length;)xe.pop()();for(let e=0;e<X.length;e+=1){const n=X[e];ie.has(n)||(ie.add(n),n())}X.length=0}while(q.length);for(;ke.length;)ke.pop()();ae=!1,ie.clear(),F(t)}function it(t){if(t.fragment!==null){t.update(),M(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(le)}}const B=new Set;let N;function _e(){N={r:0,c:[],p:N}}function pe(){N.r||M(N.c),N=N.p}function C(t,e){t&&t.i&&(B.delete(t),t.i(e))}function k(t,e,n,i){if(t&&t.o){if(B.has(t))return;B.add(t),N.c.push(()=>{B.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}}function Me(t,e){const n={},i={},c={$$scope:1};let r=t.length;for(;r--;){const d=t[r],a=e[r];if(a){for(const s in d)s in a||(i[s]=1);for(const s in a)c[s]||(n[s]=a[s],c[s]=1);t[r]=a}else for(const s in d)c[s]=1}for(const d in i)d in n||(n[d]=void 0);return n}function Ne(t){return typeof t=="object"&&t!==null?t:{}}function O(t){t&&t.c()}function E(t,e,n,i){const{fragment:c,on_mount:r,on_destroy:d,after_update:a}=t.$$;c&&c.m(e,n),i||le(()=>{const s=r.map(Le).filter(V);d?d.push(...s):M(s),t.$$.on_mount=[]}),a.forEach(le)}function S(t,e){const n=t.$$;n.fragment!==null&&(M(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function ot(t,e){t.$$.dirty[0]===-1&&(q.push(t),Ae(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function D(t,e,n,i,c,r,d,a=[-1]){const s=Y;F(t);const o=t.$$={fragment:null,ctx:null,props:r,update:m,not_equal:c,bound:$e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(s?s.$$.context:[])),callbacks:$e(),dirty:a,skip_bound:!1,root:e.target||s.$$.root};d&&d(o.root);let u=!1;if(o.ctx=n?n(t,e.props||{},(l,f,...h)=>{const v=h.length?h[0]:f;return o.ctx&&c(o.ctx[l],o.ctx[l]=v)&&(!o.skip_bound&&o.bound[l]&&o.bound[l](v),u&&ot(t,l)),f}):[],o.update(),u=!0,M(o.before_update),o.fragment=i?i(o.ctx):!1,e.target){if(e.hydrate){const l=Ze(e.target);o.fragment&&o.fragment.l(l),l.forEach(_)}else o.fragment&&o.fragment.c();e.intro&&C(t.$$.fragment),E(t,e.target,e.anchor,e.customElement),je()}F(s)}class I{$destroy(){S(this,1),this.$destroy=m}$on(e,n){const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const c=i.indexOf(n);c!==-1&&i.splice(c,1)}}$set(e){this.$$set&&!Qe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const H=[];function Ue(t,e){return{subscribe:G(t,e).subscribe}}function G(t,e=m){let n;const i=new Set;function c(a){if(L(t,a)&&(t=a,n)){const s=!H.length;for(const o of i)o[1](),H.push(o,t);if(s){for(let o=0;o<H.length;o+=2)H[o][0](H[o+1]);H.length=0}}}function r(a){c(a(t))}function d(a,s=m){const o=[a,s];return i.add(o),i.size===1&&(n=e(c)||m),a(t),()=>{i.delete(o),i.size===0&&(n(),n=null)}}return{set:c,update:r,subscribe:d}}function We(t,e,n){const i=!Array.isArray(t),c=i?[t]:t,r=e.length<2;return Ue(n,d=>{let a=!1;const s=[];let o=0,u=m;const l=()=>{if(o)return;u();const h=e(i?s[0]:s,d);r?d(h):u=V(h)?h:m},f=c.map((h,v)=>de(h,P=>{s[v]=P,o&=~(1<<v),a&&l()},()=>{o|=1<<v}));return a=!0,l(),function(){M(f),u()}})}function rt(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var n,i,c,r,d=[],a="",s=t.split("/");for(s[0]||s.shift();c=s.shift();)n=c[0],n==="*"?(d.push("wild"),a+="/(.*)"):n===":"?(i=c.indexOf("?",1),r=c.indexOf(".",1),d.push(c.substring(1,~i?i:~r?r:c.length)),a+=!!~i&&!~r?"(?:/([^/]+?))?":"/([^/]+?)",~r&&(a+=(~i?"?":"")+"\\"+c.substring(r))):a+="/"+c;return{keys:d,pattern:new RegExp("^"+a+(e?"(?=$|/)":"/?$"),"i")}}function ct(t){let e,n,i;const c=[t[2]];var r=t[0];function d(a){let s={};for(let o=0;o<c.length;o+=1)s=Oe(s,c[o]);return{props:s}}return r&&(e=new r(d()),e.$on("routeEvent",t[7])),{c(){e&&O(e.$$.fragment),n=he()},m(a,s){e&&E(e,a,s),p(a,n,s),i=!0},p(a,s){const o=s&4?Me(c,[Ne(a[2])]):{};if(r!==(r=a[0])){if(e){_e();const u=e;k(u.$$.fragment,1,0,()=>{S(u,1)}),pe()}r?(e=new r(d()),e.$on("routeEvent",a[7]),O(e.$$.fragment),C(e.$$.fragment,1),E(e,n.parentNode,n)):e=null}else r&&e.$set(o)},i(a){i||(e&&C(e.$$.fragment,a),i=!0)},o(a){e&&k(e.$$.fragment,a),i=!1},d(a){a&&_(n),e&&S(e,a)}}}function at(t){let e,n,i;const c=[{params:t[1]},t[2]];var r=t[0];function d(a){let s={};for(let o=0;o<c.length;o+=1)s=Oe(s,c[o]);return{props:s}}return r&&(e=new r(d()),e.$on("routeEvent",t[6])),{c(){e&&O(e.$$.fragment),n=he()},m(a,s){e&&E(e,a,s),p(a,n,s),i=!0},p(a,s){const o=s&6?Me(c,[s&2&&{params:a[1]},s&4&&Ne(a[2])]):{};if(r!==(r=a[0])){if(e){_e();const u=e;k(u.$$.fragment,1,0,()=>{S(u,1)}),pe()}r?(e=new r(d()),e.$on("routeEvent",a[6]),O(e.$$.fragment),C(e.$$.fragment,1),E(e,n.parentNode,n)):e=null}else r&&e.$set(o)},i(a){i||(e&&C(e.$$.fragment,a),i=!0)},o(a){e&&k(e.$$.fragment,a),i=!1},d(a){a&&_(n),e&&S(e,a)}}}function lt(t){let e,n,i,c;const r=[at,ct],d=[];function a(s,o){return s[1]?0:1}return e=a(t),n=d[e]=r[e](t),{c(){n.c(),i=he()},m(s,o){d[e].m(s,o),p(s,i,o),c=!0},p(s,[o]){let u=e;e=a(s),e===u?d[e].p(s,o):(_e(),k(d[u],1,1,()=>{d[u]=null}),pe(),n=d[e],n?n.p(s,o):(n=d[e]=r[e](s),n.c()),C(n,1),n.m(i.parentNode,i))},i(s){c||(C(n),c=!0)},o(s){k(n),c=!1},d(s){d[e].d(s),s&&_(i)}}}function Ee(){const t=window.location.href.indexOf("#/");let e=t>-1?window.location.href.substr(t+1):"/";const n=e.indexOf("?");let i="";return n>-1&&(i=e.substr(n+1),e=e.substr(0,n)),{location:e,querystring:i}}const me=Ue(null,function(e){e(Ee());const n=()=>{e(Ee())};return window.addEventListener("hashchange",n,!1),function(){window.removeEventListener("hashchange",n,!1)}});We(me,t=>t.location);We(me,t=>t.querystring);const Se=G(void 0);async function Q(t){if(!t||t.length<1||t.charAt(0)!="/"&&t.indexOf("#/")!==0)throw Error("Invalid parameter location");await Pe(),history.replaceState(be(ve({},history.state),{__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY}),void 0,void 0),window.location.hash=(t.charAt(0)=="#"?"":"#")+t}function ut(t,e,n){let{routes:i={}}=e,{prefix:c=""}=e,{restoreScrollState:r=!1}=e;class d{constructor(g,w){if(!w||typeof w!="function"&&(typeof w!="object"||w._sveltesparouter!==!0))throw Error("Invalid component object");if(!g||typeof g=="string"&&(g.length<1||g.charAt(0)!="/"&&g.charAt(0)!="*")||typeof g=="object"&&!(g instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:T,keys:$}=rt(g);this.path=g,typeof w=="object"&&w._sveltesparouter===!0?(this.component=w.component,this.conditions=w.conditions||[],this.userData=w.userData,this.props=w.props||{}):(this.component=()=>Promise.resolve(w),this.conditions=[],this.props={}),this._pattern=T,this._keys=$}match(g){if(c){if(typeof c=="string")if(g.startsWith(c))g=g.substr(c.length)||"/";else return null;else if(c instanceof RegExp){const A=g.match(c);if(A&&A[0])g=g.substr(A[0].length)||"/";else return null}}const w=this._pattern.exec(g);if(w===null)return null;if(this._keys===!1)return w;const T={};let $=0;for(;$<this._keys.length;){try{T[this._keys[$]]=decodeURIComponent(w[$+1]||"")||null}catch{T[this._keys[$]]=null}$++}return T}async checkConditions(g){for(let w=0;w<this.conditions.length;w++)if(!await this.conditions[w](g))return!1;return!0}}const a=[];i instanceof Map?i.forEach((y,g)=>{a.push(new d(g,y))}):Object.keys(i).forEach(y=>{a.push(new d(y,i[y]))});let s=null,o=null,u={};const l=st();async function f(y,g){await Pe(),l(y,g)}let h=null,v=null;r&&(v=y=>{y.state&&y.state.__svelte_spa_router_scrollY?h=y.state:h=null},window.addEventListener("popstate",v),tt(()=>{h?window.scrollTo(h.__svelte_spa_router_scrollX,h.__svelte_spa_router_scrollY):window.scrollTo(0,0)}));let P=null,j=null;const R=me.subscribe(async y=>{P=y;let g=0;for(;g<a.length;){const w=a[g].match(y.location);if(!w){g++;continue}const T={route:a[g].path,location:y.location,querystring:y.querystring,userData:a[g].userData,params:w&&typeof w=="object"&&Object.keys(w).length?w:null};if(!await a[g].checkConditions(T)){n(0,s=null),j=null,f("conditionsFailed",T);return}f("routeLoading",Object.assign({},T));const $=a[g].component;if(j!=$){$.loading?(n(0,s=$.loading),j=$,n(1,o=$.loadingParams),n(2,u={}),f("routeLoaded",Object.assign({},T,{component:s,name:s.name,params:o}))):(n(0,s=null),j=null);const A=await $();if(y!=P)return;n(0,s=A&&A.default||A),j=$}w&&typeof w=="object"&&Object.keys(w).length?n(1,o=w):n(1,o=null),n(2,u=a[g].props),f("routeLoaded",Object.assign({},T,{component:s,name:s.name,params:o})).then(()=>{Se.set(o)});return}n(0,s=null),j=null,Se.set(void 0)});nt(()=>{R(),v&&window.removeEventListener("popstate",v)});function ee(y){ce.call(this,t,y)}function te(y){ce.call(this,t,y)}return t.$$set=y=>{"routes"in y&&n(3,i=y.routes),"prefix"in y&&n(4,c=y.prefix),"restoreScrollState"in y&&n(5,r=y.restoreScrollState)},t.$$.update=()=>{t.$$.dirty&32&&(history.scrollRestoration=r?"manual":"auto")},[s,o,u,i,c,r,ee,te]}class ft extends I{constructor(e){super(),D(this,e,ut,lt,L,{routes:3,prefix:4,restoreScrollState:5})}}let He=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");var dt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ue={exports:{}};(function(t,e){(function(n,i){i(e)})(dt,function(n){function i(){const a=window.navigator.userAgent.toLocaleLowerCase();return a.indexOf("edge")!==-1?"edge":a.indexOf("chrome")!==-1&&a.indexOf("edge")===-1?"chrome":a.indexOf("safari")!==-1&&a.indexOf("chrome")===-1?"safari":a.indexOf("opera")!==-1?"opera":a.indexOf("firefox")!==-1?"firefox":"unknown"}function c(a,s){let o="";o=a==="VP8"?"video/VP8":a==="VP9"?"video/VP9":a==="H264"?"video/H264":`video/${a}`;const u=s.filter(l=>l.mimeType==o);if(u.length<1)throw new Error("invalid video codec type");return u}class r extends class{constructor(s,o,u,l=!1,f=!1){this.debug=l,this.roomId=o,this.signalingUrl=s,this.options=u,this._removeCodec=!1,this.stream=null,this.remoteStream=null,this._pc=null,this._ws=null,this.authnMetadata=null,this.authzMetadata=null,this._dataChannels=[],this._isOffer=!1,this._isExistUser=!1,this.connectionState="new",this._pcConfig={iceServers:this.options.iceServers,iceTransportPolicy:f?"relay":"all"},this._callbacks={open:()=>{},connect:()=>{},disconnect:()=>{},addstream:()=>{},removestream:()=>{},bye:()=>{},datachannel:()=>{}}}on(s,o){s in this._callbacks&&(this._callbacks[s]=o)}async _disconnect(){await this._dataChannels.forEach(async s=>{await this._closeDataChannel(s)}),await this._closePeerConnection(),await this._closeWebSocketConnection(),this.authzMetadata=null,this._removeCodec=!1,this._isOffer=!1,this._isExistUser=!1,this._dataChannels=[],this.connectionState="new"}async _signaling(){return new Promise((s,o)=>{if(this._ws)return o("WS-ALREADY-EXISTS");this._ws=new WebSocket(this.signalingUrl),this._ws.onclose=async()=>(await this._disconnect(),this._callbacks.disconnect({reason:"WS-CLOSED"}),o("WS-CLOSED")),this._ws.onerror=async()=>(await this._disconnect(),o("WS-CLOSED-WITH-ERROR")),this._ws.onopen=()=>{const u={type:"register",roomId:this.roomId,clientId:this.options.clientId,authnMetadata:void 0,key:void 0};this.authnMetadata!==null&&(u.authnMetadata=this.authnMetadata),this.options.signalingKey!==null&&(u.key=this.options.signalingKey),this._sendWs(u),this._ws&&(this._ws.onmessage=async l=>{try{if(typeof l.data!="string")return;const f=JSON.parse(l.data);if(f.type==="ping")this._sendWs({type:"pong"});else{if(f.type==="bye")return this._callbacks.bye(l),s();if(f.type==="accept")return this.authzMetadata=f.authzMetadata,Array.isArray(f.iceServers)&&f.iceServers.length>0&&(this._traceLog("iceServers=>",f.iceServers),this._pcConfig.iceServers=f.iceServers),this._traceLog("isExistUser=>",f.isExistUser),this._isExistUser=f.isExistUser,this._createPeerConnection(),this._isExistUser===!0&&await this._sendOffer(),s();if(f.type==="reject")return await this._disconnect(),this._callbacks.disconnect({reason:f.reason||"REJECTED"}),o("REJECTED");if(f.type==="offer")this._pc&&this._pc.signalingState==="have-local-offer"&&this._createPeerConnection(),this._setOffer(new RTCSessionDescription(f));else if(f.type==="answer")await this._setAnswer(new RTCSessionDescription(f));else if(f.type==="candidate"&&f.ice){this._traceLog("Received ICE candidate ...",f.ice);const h=new RTCIceCandidate(f.ice);this._addIceCandidate(h)}}}catch(f){await this._disconnect(),this._callbacks.disconnect({reason:"SIGNALING-ERROR",error:f})}})}})}_createPeerConnection(){this._traceLog("RTCConfiguration=>",this._pcConfig);const s=new RTCPeerConnection(this._pcConfig),o=this.stream&&this.stream.getAudioTracks()[0];o&&this.options.audio.direction!=="recvonly"?s.addTrack(o,this.stream):this.options.audio.enabled&&s.addTransceiver("audio",{direction:"recvonly"});const u=this.stream&&this.stream.getVideoTracks()[0];if(u&&this.options.video.direction!=="recvonly"){const f=s.addTrack(u,this.stream),h=this._getTransceiver(s,f);if(this._isVideoCodecSpecified()&&h!==null)if(h.setCodecPreferences!==void 0){const v=RTCRtpSender.getCapabilities("video");if(v){let P=[];this.options.video.codec&&(P=c(this.options.video.codec,v.codecs)),this._traceLog("video codecs=",P),h.setCodecPreferences(P)}}else this._removeCodec=!0}else if(this.options.video.enabled){const f=s.addTransceiver("video",{direction:"recvonly"});if(this._isVideoCodecSpecified())if(f.setCodecPreferences!==void 0){const h=RTCRtpSender.getCapabilities("video");if(h){let v=[];this.options.video.codec&&(v=c(this.options.video.codec,h.codecs)),this._traceLog("video codecs=",v),f.setCodecPreferences(v)}}else this._removeCodec=!0}const l=[];s.ontrack=f=>{const h=f;if(this._traceLog("peer.ontrack()",f),i()==="safari"){l.push(f.track);const v=new MediaStream(l);this.remoteStream=v}else this.remoteStream=f.streams[0];h.stream=this.remoteStream,this._callbacks.addstream(h)},s.onicecandidate=f=>{this._traceLog("peer.onicecandidate()",f),f.candidate?this._sendIceCandidate(f.candidate):this._traceLog("empty ice event","")},s.oniceconnectionstatechange=async()=>{if(this._traceLog("ICE connection Status has changed to ",s.iceConnectionState),this.connectionState!==s.iceConnectionState)switch(this.connectionState=s.iceConnectionState,this.connectionState){case"connected":this._isOffer=!1,this._callbacks.connect();break;case"disconnected":case"failed":await this._disconnect(),this._callbacks.disconnect({reason:"ICE-CONNECTION-STATE-FAILED"})}},s.onsignalingstatechange=f=>{this._traceLog("signaling state changes:",s.signalingState)},s.ondatachannel=this._onDataChannel.bind(this),this._pc?this._pc=s:(this._pc=s,this._callbacks.open({authzMetadata:this.authzMetadata}))}async _createDataChannel(s,o){return new Promise((u,l)=>{if(!this._pc)return l("PeerConnection Does Not Ready");if(this._isOffer)return l("PeerConnection Has Local Offer");let f=this._findDataChannel(s);return f?l("DataChannel Already Exists!"):this._isExistUser?(f=this._pc.createDataChannel(s,o),f.onclose=h=>{this._traceLog("datachannel onclosed=>",h),this._dataChannels=this._dataChannels.filter(v=>v.label!=s)},f.onerror=h=>{this._traceLog("datachannel onerror=>",h),this._dataChannels=this._dataChannels.filter(v=>v.label!=s)},f.onmessage=h=>{this._traceLog("datachannel onmessage=>",h.data),h.label=s},f.onopen=h=>{this._traceLog("datachannel onopen=>",h)},this._dataChannels.push(f),u(f)):u(null)})}_onDataChannel(s){if(this._traceLog("on data channel",s),!this._pc)return;const o=s.channel,u=s.channel.label;s.channel&&(!u||u.length<1||(o.onopen=async l=>{this._traceLog("datachannel onopen=>",l)},o.onclose=async l=>{this._traceLog("datachannel onclosed=>",l)},o.onerror=async l=>{this._traceLog("datachannel onerror=>",l)},o.onmessage=l=>{this._traceLog("datachannel onmessage=>",l.data),l.label=u},this._findDataChannel(u)?this._dataChannels=this._dataChannels.map(l=>l.label==u?o:l):this._dataChannels.push(s.channel),this._callbacks.datachannel(o)))}async _sendOffer(){if(!this._pc)return;i()==="safari"&&(this.options.video.enabled&&this.options.video.direction==="sendrecv"&&this._pc.addTransceiver("video",{direction:"recvonly"}),this.options.audio.enabled&&this.options.audio.direction==="sendrecv"&&this._pc.addTransceiver("audio",{direction:"recvonly"}));const s=await this._pc.createOffer({offerToReceiveAudio:this.options.audio.enabled&&this.options.audio.direction!=="sendonly",offerToReceiveVideo:this.options.video.enabled&&this.options.video.direction!=="sendonly"});this._removeCodec&&this.options.video.codec&&["VP8","VP9","H264"].forEach(o=>{this.options.video.codec!==o&&(s.sdp=function(u,l){return function f(h){const v=new RegExp("(a=rtpmap:(\\d*) "+l+"/90000\\r\\n)"),P=h.match(v);if(P==null||P.length<=2)return u;const j=P[2];let R=h.replace(v,"");const ee=new RegExp("(a=rtcp-fb:"+j+`.*\r
)`,"g");R=R.replace(ee,"");const te=new RegExp("(a=fmtp:"+j+`.*\r
)`,"g");R=R.replace(te,"");const y=new RegExp("(a=fmtp:(\\d*) apt="+j+"\\r\\n)"),g=R.match(y);let w="";if(g!=null&&g.length>=3){w=g[2],R=R.replace(y,"");const A=new RegExp("(a=rtpmap:"+w+`.*\r
)`,"g");R=R.replace(A,"")}const T=/(m=video.*\r\n)/,$=R.match(T);if($!=null){const A=$[0].substring(0,$[0].length-2).split(" ");let ne=A[0];A.forEach((se,Ye)=>{Ye!==0&&se!=j&&se!=w&&(ne+=" "+se)}),ne+=`\r
`,R=R.replace(T,ne)}return f(R)}(u)}(s.sdp,o))}),this._traceLog("create offer sdp, sdp=",s.sdp),await this._pc.setLocalDescription(s),this._pc.localDescription&&this._sendSdp(this._pc.localDescription),this._isOffer=!0}_isVideoCodecSpecified(){return this.options.video.enabled&&this.options.video.codec!==null}async _createAnswer(){if(this._pc)try{const s=await this._pc.createAnswer();this._traceLog("create answer sdp, sdp=",s.sdp),await this._pc.setLocalDescription(s),this._pc.localDescription&&this._sendSdp(this._pc.localDescription)}catch(s){await this._disconnect(),this._callbacks.disconnect({reason:"CREATE-ANSWER-ERROR",error:s})}}async _setAnswer(s){this._pc&&(await this._pc.setRemoteDescription(s),this._traceLog("set answer sdp=",s.sdp))}async _setOffer(s){try{if(!this._pc)return;await this._pc.setRemoteDescription(s),this._traceLog("set offer sdp=",s.sdp),await this._createAnswer()}catch(o){await this._disconnect(),this._callbacks.disconnect({reason:"SET-OFFER-ERROR",error:o})}}async _addIceCandidate(s){try{this._pc&&await this._pc.addIceCandidate(s)}catch{this._traceLog("invalid ice candidate",s)}}_sendIceCandidate(s){const o={type:"candidate",ice:s};this._sendWs(o)}_sendSdp(s){this._sendWs(s)}_sendWs(s){this._ws&&this._ws.send(JSON.stringify(s))}_getTransceiver(s,o){let u=null;if(s.getTransceivers().forEach(l=>{l.sender!=o&&l.receiver!=o||(u=l)}),!u)throw new Error("invalid transceiver");return u}_findDataChannel(s){return this._dataChannels.find(o=>o.label==s)}async _closeDataChannel(s){return new Promise(o=>{if(s.readyState==="closed")return o();s.onclose=null;const u=setInterval(()=>{if(s.readyState==="closed")return clearInterval(u),o()},400);s&&s.close()})}async _closePeerConnection(){return new Promise(s=>{if(i()==="safari"&&this._pc)return this._pc.oniceconnectionstatechange=()=>{},this._pc.close(),this._pc=null,s();if(!this._pc)return s();if(this._pc&&this._pc.signalingState=="closed")return this._pc=null,s();this._pc.oniceconnectionstatechange=()=>{};const o=setInterval(()=>this._pc?this._pc&&this._pc.signalingState=="closed"?(this._pc=null,clearInterval(o),s()):void 0:(clearInterval(o),s()),400);this._pc.close()})}async _closeWebSocketConnection(){return new Promise(s=>{if(!this._ws)return s();if(this._ws&&this._ws.readyState===3)return this._ws=null,s();this._ws.onclose=()=>{};const o=setInterval(()=>this._ws?this._ws.readyState===3?(this._ws=null,clearInterval(o),s()):void 0:(clearInterval(o),s()),400);this._ws&&this._ws.close()})}_traceLog(s,o){this.debug&&function(u,l){let f="";window.performance&&(f="[Ayame "+(window.performance.now()/1e3).toFixed(3)+"]"),i()==="edge"?console.log(f+" "+u+`
`,l):console.info(f+" "+u+`
`,l)}(s,o)}}{constructor(s,o,u,l=!1,f=!1){super(s,o,u,l,f)}async connect(s,o=null){if(this._ws||this._pc)throw this._traceLog("connection already exists"),new Error("Connection Already Exists!");this.stream=s,o&&(this.authnMetadata=o.authnMetadata),await this._signaling()}async createDataChannel(s,o){return await this._createDataChannel(s,o)}async removeDataChannel(s){this._traceLog("datachannel remove=>",s);const o=this._findDataChannel(s);if(!o||o.readyState!=="open")throw new Error("data channel is not exist or open");await this._closeDataChannel(o)}async disconnect(){return new Promise(s=>(this._ws&&this._ws.close(),s()))}}const d={audio:{direction:"sendrecv",enabled:!0},video:{direction:"sendrecv",enabled:!0},iceServers:[],clientId:function(a){const s=[],o="0123456789";for(;a--;)s.push(o.charAt(Math.floor(Math.random()*o.length)));return s.join("")}(17)};n.connection=function(a,s,o=d,u=!1,l=!1){return new r(a,s,o,u,l)},n.defaultOptions=d,n.version=function(){return process.version},Object.defineProperty(n,"__esModule",{value:!0})})})(ue,ue.exports);const ht="wss://ayame-labo.shiguredo.app/signaling",Ve=G(),Z=G(),ze=G();async function qe(){var t;_t(),await((t=Re(Ve))==null?void 0:t.disconnect())}async function Fe(t){const e=`one-on-one-jp-${t}`,n=ue.exports.connection(ht,e),i=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});await n.connect(i),n.on("disconnect",console.log),n.on("addstream",c=>{ze.set(c.stream)}),Ve.set(n),Z.set(i)}function _t(){var t;(t=Re(Z))==null||t.getTracks().forEach(e=>e.stop())}function fe(t,e){return t.srcObject=e,{update(n){t.srcObject!==n&&(t.srcObject=n)},destroy(){}}}function pt(t){let e,n,i,c,r,d,a,s,o;return{c(){e=b("ul"),e.innerHTML=`<li>\u30AB\u30E1\u30E9\u6620\u50CF\u304C\u6B63\u3057\u304F\u8868\u793A\u3055\u308C\u3066\u3044\u307E\u3059\u304B\uFF1F</li> 
  <li>\u30DE\u30A4\u30AF\u97F3\u58F0\u304C\u30B9\u30D4\u30FC\u30AB\u30FC\u304B\u3089\u6D41\u308C\u307E\u3059\u304B\uFF1F</li> 
  <li>\u554F\u984C\u304C\u7121\u3051\u308C\u3070\u78BA\u8A8D\u306F\u5B8C\u4E86\u3067\u3059\u3002</li>`,n=x(),i=b("video"),r=x(),d=b("div"),a=b("button"),a.textContent="\u9000\u5BA4\u3059\u308B",i.autoplay=!0,i.playsInline=!0},m(u,l){p(u,e,l),p(u,n,l),p(u,i,l),p(u,r,l),p(u,d,l),z(d,a),s||(o=[re(c=fe.call(null,i,t[0])),U(a,"click",t[1])],s=!0)},p(u,[l]){c&&V(c.update)&&l&1&&c.update.call(null,u[0])},i:m,o:m,d(u){u&&_(e),u&&_(n),u&&_(i),u&&_(r),u&&_(d),s=!1,M(o)}}}function mt(t,e,n){let i;oe(t,Z,r=>n(0,i=r)),Ie(()=>{Fe(He())});function c(){qe(),Q("/")}return[i,c]}class gt extends I{constructor(e){super(),D(this,e,mt,pt,L,{})}}function wt(t){let e,n,i;return{c(){e=b("h1"),e.textContent="One on One in \u65E5\u672C!",W(e,"class","svelte-10qdmii")},m(c,r){p(c,e,r),n||(i=U(e,"click",t[0]),n=!0)},p:m,i:m,o:m,d(c){c&&_(e),n=!1,i()}}}function yt(t){function e(n){ce.call(this,t,n)}return[e]}class ge extends I{constructor(e){super(),D(this,e,yt,wt,L,{})}}function vt(t){let e,n,i,c;return e=new ge({}),i=new gt({}),{c(){O(e.$$.fragment),n=x(),O(i.$$.fragment)},m(r,d){E(e,r,d),p(r,n,d),E(i,r,d),c=!0},p:m,i(r){c||(C(e.$$.fragment,r),C(i.$$.fragment,r),c=!0)},o(r){k(e.$$.fragment,r),k(i.$$.fragment,r),c=!1},d(r){S(e,r),r&&_(n),S(i,r)}}}class bt extends I{constructor(e){super(),D(this,e,null,vt,L,{})}}function $t(t){let e,n,i,c,r,d,a,s,o;return{c(){e=b("h2"),e.textContent="\u30EB\u30FC\u30E0",n=x(),i=b("input"),c=x(),r=b("button"),r.textContent="\u5165\u5BA4\u3059\u308B",d=x(),a=b("button"),a.textContent="\u30EB\u30FC\u30E0ID\u751F\u6210",W(i,"type","text"),W(i,"placeholder","\u30EB\u30FC\u30E0ID\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044"),W(i,"class","svelte-gzebfg")},m(u,l){p(u,e,l),p(u,n,l),p(u,i,l),Ce(i,t[0]),p(u,c,l),p(u,r,l),p(u,d,l),p(u,a,l),s||(o=[U(i,"input",t[3]),U(r,"click",t[2]),U(a,"click",t[1])],s=!0)},p(u,[l]){l&1&&i.value!==u[0]&&Ce(i,u[0])},i:m,o:m,d(u){u&&_(e),u&&_(n),u&&_(i),u&&_(c),u&&_(r),u&&_(d),u&&_(a),s=!1,M(o)}}}function Ct(t,e,n){let i="";function c(){n(0,i=He());var a="text/plain",s=new Blob([i],{type:a}),o=[new window.ClipboardItem({[a]:s})];navigator.clipboard.write(o).then(function(){},function(){})}function r(){if(i===""){alert("\u30EB\u30FC\u30E0ID\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044!");return}Q(`/room/${i}`)}function d(){i=this.value,n(0,i)}return[i,c,r,d]}class xt extends I{constructor(e){super(),D(this,e,Ct,$t,L,{})}}function kt(t){let e,n,i,c,r,d,a;return{c(){e=b("h2"),e.textContent="\u30AB\u30E1\u30E9\u30FB\u30DE\u30A4\u30AF\u30C1\u30A7\u30C3\u30AF",n=x(),i=b("button"),i.textContent="\u30AB\u30E1\u30E9\u30FB\u30DE\u30A4\u30AF\u30C1\u30A7\u30C3\u30AF",c=x(),r=b("p"),r.textContent="\u203B\u30DE\u30A4\u30AF\u304C\u30B9\u30D4\u30FC\u30AB\u30FC\u97F3\u3092\u62FE\u3046\u3068\u3001\u30CF\u30A6\u30EA\u30F3\u30B0\u3059\u308B\u5834\u5408\u304C\u3042\u308A\u307E\u3059\u3002\u305D\u306E\u5834\u5408\u306F\u4E00\u5EA6\u9000\u5BA4\u3057\u3001\u30B9\u30D4\u30FC\u30AB\u30FC\u97F3\u3092\u5C11\u3057\u843D\u3068\u3057\u305F\u4E0A\u3067\u518D\u5EA6\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002"},m(s,o){p(s,e,o),p(s,n,o),p(s,i,o),p(s,c,o),p(s,r,o),d||(a=U(i,"click",t[0]),d=!0)},p:m,i:m,o:m,d(s){s&&_(e),s&&_(n),s&&_(i),s&&_(c),s&&_(r),d=!1,a()}}}function Et(t){return[()=>Q("/checker")]}class St extends I{constructor(e){super(),D(this,e,Et,kt,L,{})}}function Ot(t){let e,n,i;return{c(){e=b("h2"),e.textContent="\u6280\u8853\u60C5\u5831",n=x(),i=b("ul"),i.innerHTML=`<li>Signaling Server \u306B
    <a href="https://ayame-labo.shiguredo.app/" target="_blank">Ayame Labo</a>
    \u3092\u5229\u7528\u3057\u3066\u3044\u307E\u3059\u3002</li> 

  <li>\u300COne on One in \u65E5\u672C\u300D\u306E\u30BD\u30FC\u30B9\u30B3\u30FC\u30C9\u306F
    <a href="https://github.com/ampcpmgp/one-on-one" target="_blank">\u3053\u3061\u3089</a></li>`},m(c,r){p(c,e,r),p(c,n,r),p(c,i,r)},p:m,i:m,o:m,d(c){c&&_(e),c&&_(n),c&&_(i)}}}class Lt extends I{constructor(e){super(),D(this,e,null,Ot,L,{})}}function Rt(t){let e,n,i;return{c(){e=b("h2"),e.textContent="\u4F7F\u3044\u65B9",n=x(),i=b("ul"),i.innerHTML=`<li>\u307E\u305A\u306F\u300C\u30AB\u30E1\u30E9\u30FB\u30DE\u30A4\u30AF\u30C1\u30A7\u30C3\u30AF\u300D\u304B\u3089\u3001\u81EA\u62E0\u70B9\u306E\u6620\u50CF\u3068\u97F3\u58F0\u3092\u78BA\u8A8D\u3092\u3057\u3066\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u78BA\u8A8D\u304C\u7D42\u308F\u308A\u307E\u3057\u305F\u3089\u3001\u300C\u30EB\u30FC\u30E0\u300D\u3088\u308A\u3001\u30EB\u30FC\u30E0ID\u3092\u751F\u6210\u3057\u3066\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u30EB\u30FC\u30E0ID\u751F\u6210\u5F8C\u3001\u30AF\u30EA\u30C3\u30D7\u30DC\u30FC\u30C9\u306BID\u304C\u30B3\u30D4\u30FC\u3055\u308C\u307E\u3059\u3002\u305D\u306EID\u3092\u76F8\u624B\u306B\u304A\u4F1D\u3048\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u53D7\u3051\u53D6\u3063\u305F\u65B9\u306F\u30EB\u30FC\u30E0ID\u3092\u30C6\u30AD\u30B9\u30C8\u6B04\u306B\u5165\u529B\u3057\u3001\u300C\u5165\u5BA4\u3059\u308B\u300D\u30DC\u30BF\u30F3\u3092\u62BC\u3057\u3066\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u304A\u4E92\u3044\u304C\u5165\u5BA4\u3059\u308B\u3068\u30D3\u30C7\u30AA\u901A\u8A71\u304C\u53EF\u80FD\u306B\u306A\u308A\u307E\u3059\u3002</li>`},m(c,r){p(c,e,r),p(c,n,r),p(c,i,r)},p:m,i:m,o:m,d(c){c&&_(e),c&&_(n),c&&_(i)}}}class Dt extends I{constructor(e){super(),D(this,e,null,Rt,L,{})}}function It(t){let e,n,i;return{c(){e=b("h2"),e.textContent="\u6982\u8981",n=x(),i=b("ul"),i.innerHTML=`<li>\u3053\u306E\u30A2\u30D7\u30EA\u306F 1:1 \u5C02\u7528\u306E\u30D3\u30C7\u30AA\u901A\u8A71\u30A2\u30D7\u30EA\u3067\u3059\u3002</li> 
  <li>\u65E5\u672C\u56FD\u5916\u304B\u3089\u306F\u3054\u5229\u7528\u3067\u304D\u307E\u305B\u3093\u3002</li> 
  <li>\u540C\u50DA\u3084\u53CB\u4EBA\u3068\u304A\u4F7F\u3044\u304F\u3060\u3055\u3044\u3002\u4E0D\u7279\u5B9A\u591A\u6570\u3068\u7E4B\u304C\u308B\u3053\u3068\u306F\u3067\u304D\u307E\u305B\u3093\u3002</li>`},m(c,r){p(c,e,r),p(c,n,r),p(c,i,r)},p:m,i:m,o:m,d(c){c&&_(e),c&&_(n),c&&_(i)}}}class Tt extends I{constructor(e){super(),D(this,e,null,It,L,{})}}function At(t){let e,n,i,c,r,d,a,s,o,u;return e=new Tt({}),i=new Dt({}),r=new St({}),a=new xt({}),o=new Lt({}),{c(){O(e.$$.fragment),n=x(),O(i.$$.fragment),c=x(),O(r.$$.fragment),d=x(),O(a.$$.fragment),s=x(),O(o.$$.fragment)},m(l,f){E(e,l,f),p(l,n,f),E(i,l,f),p(l,c,f),E(r,l,f),p(l,d,f),E(a,l,f),p(l,s,f),E(o,l,f),u=!0},p:m,i(l){u||(C(e.$$.fragment,l),C(i.$$.fragment,l),C(r.$$.fragment,l),C(a.$$.fragment,l),C(o.$$.fragment,l),u=!0)},o(l){k(e.$$.fragment,l),k(i.$$.fragment,l),k(r.$$.fragment,l),k(a.$$.fragment,l),k(o.$$.fragment,l),u=!1},d(l){S(e,l),l&&_(n),S(i,l),l&&_(c),S(r,l),l&&_(d),S(a,l),l&&_(s),S(o,l)}}}class Pt extends I{constructor(e){super(),D(this,e,null,At,L,{})}}function jt(t){let e,n,i,c;return e=new ge({}),i=new Pt({}),{c(){O(e.$$.fragment),n=x(),O(i.$$.fragment)},m(r,d){E(e,r,d),p(r,n,d),E(i,r,d),c=!0},p:m,i(r){c||(C(e.$$.fragment,r),C(i.$$.fragment,r),c=!0)},o(r){k(e.$$.fragment,r),k(i.$$.fragment,r),c=!1},d(r){S(e,r),r&&_(n),S(i,r)}}}class Mt extends I{constructor(e){super(),D(this,e,null,jt,L,{})}}function Nt(t){let e;return{c(){e=b("p"),e.textContent="404"},m(n,i){p(n,e,i)},p:m,i:m,o:m,d(n){n&&_(e)}}}class Ut extends I{constructor(e){super(),D(this,e,null,Nt,L,{})}}function Wt(t){let e,n,i,c,r,d,a,s,o,u,l;return{c(){e=b("div"),n=b("video"),c=x(),r=b("video"),a=x(),s=b("div"),o=b("button"),o.textContent="\u9000\u5BA4\u3059\u308B",n.muted=!0,n.autoplay=!0,n.playsInline=!0,W(n,"class","svelte-1eo6cx9"),r.autoplay=!0,r.playsInline=!0,W(r,"class","svelte-1eo6cx9"),W(e,"class","videos svelte-1eo6cx9")},m(f,h){p(f,e,h),z(e,n),z(e,c),z(e,r),p(f,a,h),p(f,s,h),z(s,o),u||(l=[re(i=fe.call(null,n,t[0])),re(d=fe.call(null,r,t[1])),U(o,"click",t[2])],u=!0)},p(f,[h]){i&&V(i.update)&&h&1&&i.update.call(null,f[0]),d&&V(d.update)&&h&2&&d.update.call(null,f[1])},i:m,o:m,d(f){f&&_(e),f&&_(a),f&&_(s),u=!1,M(l)}}}function Ht(t,e,n){let i,c;oe(t,Z,a=>n(0,i=a)),oe(t,ze,a=>n(1,c=a));let{params:r={}}=e;Ie(()=>{Fe(r.id)});function d(){qe(),Q("/")}return t.$$set=a=>{"params"in a&&n(3,r=a.params)},[i,c,d,r]}class Vt extends I{constructor(e){super(),D(this,e,Ht,Wt,L,{params:3})}}function zt(t){let e,n,i,c;return e=new ge({}),i=new Vt({}),{c(){O(e.$$.fragment),n=x(),O(i.$$.fragment)},m(r,d){E(e,r,d),p(r,n,d),E(i,r,d),c=!0},p:m,i(r){c||(C(e.$$.fragment,r),C(i.$$.fragment,r),c=!0)},o(r){k(e.$$.fragment,r),k(i.$$.fragment,r),c=!1},d(r){S(e,r),r&&_(n),S(i,r)}}}class qt extends I{constructor(e){super(),D(this,e,null,zt,L,{})}}var Ft={"/":Mt,"/checker":bt,"/room/:id":qt,"*":Ut};function Yt(t){let e,n;return e=new ft({props:{routes:Ft}}),{c(){O(e.$$.fragment)},m(i,c){E(e,i,c),n=!0},p:m,i(i){n||(C(e.$$.fragment,i),n=!0)},o(i){k(e.$$.fragment,i),n=!1},d(i){S(e,i)}}}class Gt extends I{constructor(e){super(),D(this,e,null,Yt,L,{})}}new Gt({target:document.body});
