var Ye=Object.defineProperty,Ge=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var ge=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var we=(t,e,s)=>e in t?Ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ye=(t,e)=>{for(var s in e||(e={}))Xe.call(e,s)&&we(t,s,e[s]);if(ge)for(var s of ge(e))Be.call(e,s)&&we(t,s,e[s]);return t},be=(t,e)=>Ge(t,Je(e));function m(){}function Se(t,e){for(const s in e)t[s]=e[s];return t}function Oe(t){return t()}function ve(){return Object.create(null)}function M(t){t.forEach(Oe)}function H(t){return typeof t=="function"}function R(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Ke(t){return Object.keys(t).length===0}function fe(t,...e){if(t==null)return m;const s=t.subscribe(...e);return s.unsubscribe?()=>s.unsubscribe():s}function Re(t){let e;return fe(t,s=>e=s)(),e}function ie(t,e,s){t.$$.on_destroy.push(fe(e,s))}function oe(t){return t&&H(t.destroy)?t.destroy:m}function _(t,e,s){t.insertBefore(e,s||null)}function h(t){t.parentNode.removeChild(t)}function v(t){return document.createElement(t)}function Le(t){return document.createTextNode(t)}function E(){return Le(" ")}function de(){return Le("")}function U(t,e,s,i){return t.addEventListener(e,s,i),()=>t.removeEventListener(e,s,i)}function G(t,e,s){s==null?t.removeAttribute(e):t.getAttribute(e)!==s&&t.setAttribute(e,s)}function Qe(t){return Array.from(t.childNodes)}function $e(t,e){t.value=e==null?"":e}function Ze(t,e,{bubbles:s=!1,cancelable:i=!1}={}){const c=document.createEvent("CustomEvent");return c.initCustomEvent(t,s,i,e),c}let q;function z(t){q=t}function B(){if(!q)throw new Error("Function called outside component initialization");return q}function De(t){B().$$.on_mount.push(t)}function et(t){B().$$.after_update.push(t)}function tt(t){B().$$.on_destroy.push(t)}function nt(){const t=B();return(e,s,{cancelable:i=!1}={})=>{const c=t.$$.callbacks[e];if(c){const r=Ze(e,s,{cancelable:i});return c.slice().forEach(f=>{f.call(t,r)}),!r.defaultPrevented}return!0}}function re(t,e){const s=t.$$.callbacks[e.type];s&&s.slice().forEach(i=>i.call(this,e))}const V=[],Ce=[],J=[],ke=[],Ie=Promise.resolve();let ce=!1;function Te(){ce||(ce=!0,Ie.then(Pe))}function Ae(){return Te(),Ie}function ae(t){J.push(t)}const se=new Set;let Y=0;function Pe(){const t=q;do{for(;Y<V.length;){const e=V[Y];Y++,z(e),st(e.$$)}for(z(null),V.length=0,Y=0;Ce.length;)Ce.pop()();for(let e=0;e<J.length;e+=1){const s=J[e];se.has(s)||(se.add(s),s())}J.length=0}while(V.length);for(;ke.length;)ke.pop()();ce=!1,se.clear(),z(t)}function st(t){if(t.fragment!==null){t.update(),M(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ae)}}const X=new Set;let N;function he(){N={r:0,c:[],p:N}}function _e(){N.r||M(N.c),N=N.p}function C(t,e){t&&t.i&&(X.delete(t),t.i(e))}function k(t,e,s,i){if(t&&t.o){if(X.has(t))return;X.add(t),N.c.push(()=>{X.delete(t),i&&(s&&t.d(1),i())}),t.o(e)}}function je(t,e){const s={},i={},c={$$scope:1};let r=t.length;for(;r--;){const f=t[r],a=e[r];if(a){for(const n in f)n in a||(i[n]=1);for(const n in a)c[n]||(s[n]=a[n],c[n]=1);t[r]=a}else for(const n in f)c[n]=1}for(const f in i)f in s||(s[f]=void 0);return s}function Me(t){return typeof t=="object"&&t!==null?t:{}}function O(t){t&&t.c()}function x(t,e,s,i){const{fragment:c,on_mount:r,on_destroy:f,after_update:a}=t.$$;c&&c.m(e,s),i||ae(()=>{const n=r.map(Oe).filter(H);f?f.push(...n):M(n),t.$$.on_mount=[]}),a.forEach(ae)}function S(t,e){const s=t.$$;s.fragment!==null&&(M(s.on_destroy),s.fragment&&s.fragment.d(e),s.on_destroy=s.fragment=null,s.ctx=[])}function it(t,e){t.$$.dirty[0]===-1&&(V.push(t),Te(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function D(t,e,s,i,c,r,f,a=[-1]){const n=q;z(t);const o=t.$$={fragment:null,ctx:null,props:r,update:m,not_equal:c,bound:ve(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(n?n.$$.context:[])),callbacks:ve(),dirty:a,skip_bound:!1,root:e.target||n.$$.root};f&&f(o.root);let u=!1;if(o.ctx=s?s(t,e.props||{},(l,d,...p)=>{const b=p.length?p[0]:d;return o.ctx&&c(o.ctx[l],o.ctx[l]=b)&&(!o.skip_bound&&o.bound[l]&&o.bound[l](b),u&&it(t,l)),d}):[],o.update(),u=!0,M(o.before_update),o.fragment=i?i(o.ctx):!1,e.target){if(e.hydrate){const l=Qe(e.target);o.fragment&&o.fragment.l(l),l.forEach(h)}else o.fragment&&o.fragment.c();e.intro&&C(t.$$.fragment),x(t,e.target,e.anchor,e.customElement),Pe()}z(n)}class I{$destroy(){S(this,1),this.$destroy=m}$on(e,s){const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(s),()=>{const c=i.indexOf(s);c!==-1&&i.splice(c,1)}}$set(e){this.$$set&&!Ke(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const W=[];function Ne(t,e){return{subscribe:F(t,e).subscribe}}function F(t,e=m){let s;const i=new Set;function c(a){if(R(t,a)&&(t=a,s)){const n=!W.length;for(const o of i)o[1](),W.push(o,t);if(n){for(let o=0;o<W.length;o+=2)W[o][0](W[o+1]);W.length=0}}}function r(a){c(a(t))}function f(a,n=m){const o=[a,n];return i.add(o),i.size===1&&(s=e(c)||m),a(t),()=>{i.delete(o),i.size===0&&(s(),s=null)}}return{set:c,update:r,subscribe:f}}function Ue(t,e,s){const i=!Array.isArray(t),c=i?[t]:t,r=e.length<2;return Ne(s,f=>{let a=!1;const n=[];let o=0,u=m;const l=()=>{if(o)return;u();const p=e(i?n[0]:n,f);r?f(p):u=H(p)?p:m},d=c.map((p,b)=>fe(p,P=>{n[b]=P,o&=~(1<<b),a&&l()},()=>{o|=1<<b}));return a=!0,l(),function(){M(d),u()}})}function ot(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var s,i,c,r,f=[],a="",n=t.split("/");for(n[0]||n.shift();c=n.shift();)s=c[0],s==="*"?(f.push("wild"),a+="/(.*)"):s===":"?(i=c.indexOf("?",1),r=c.indexOf(".",1),f.push(c.substring(1,~i?i:~r?r:c.length)),a+=!!~i&&!~r?"(?:/([^/]+?))?":"/([^/]+?)",~r&&(a+=(~i?"?":"")+"\\"+c.substring(r))):a+="/"+c;return{keys:f,pattern:new RegExp("^"+a+(e?"(?=$|/)":"/?$"),"i")}}function rt(t){let e,s,i;const c=[t[2]];var r=t[0];function f(a){let n={};for(let o=0;o<c.length;o+=1)n=Se(n,c[o]);return{props:n}}return r&&(e=new r(f()),e.$on("routeEvent",t[7])),{c(){e&&O(e.$$.fragment),s=de()},m(a,n){e&&x(e,a,n),_(a,s,n),i=!0},p(a,n){const o=n&4?je(c,[Me(a[2])]):{};if(r!==(r=a[0])){if(e){he();const u=e;k(u.$$.fragment,1,0,()=>{S(u,1)}),_e()}r?(e=new r(f()),e.$on("routeEvent",a[7]),O(e.$$.fragment),C(e.$$.fragment,1),x(e,s.parentNode,s)):e=null}else r&&e.$set(o)},i(a){i||(e&&C(e.$$.fragment,a),i=!0)},o(a){e&&k(e.$$.fragment,a),i=!1},d(a){a&&h(s),e&&S(e,a)}}}function ct(t){let e,s,i;const c=[{params:t[1]},t[2]];var r=t[0];function f(a){let n={};for(let o=0;o<c.length;o+=1)n=Se(n,c[o]);return{props:n}}return r&&(e=new r(f()),e.$on("routeEvent",t[6])),{c(){e&&O(e.$$.fragment),s=de()},m(a,n){e&&x(e,a,n),_(a,s,n),i=!0},p(a,n){const o=n&6?je(c,[n&2&&{params:a[1]},n&4&&Me(a[2])]):{};if(r!==(r=a[0])){if(e){he();const u=e;k(u.$$.fragment,1,0,()=>{S(u,1)}),_e()}r?(e=new r(f()),e.$on("routeEvent",a[6]),O(e.$$.fragment),C(e.$$.fragment,1),x(e,s.parentNode,s)):e=null}else r&&e.$set(o)},i(a){i||(e&&C(e.$$.fragment,a),i=!0)},o(a){e&&k(e.$$.fragment,a),i=!1},d(a){a&&h(s),e&&S(e,a)}}}function at(t){let e,s,i,c;const r=[ct,rt],f=[];function a(n,o){return n[1]?0:1}return e=a(t),s=f[e]=r[e](t),{c(){s.c(),i=de()},m(n,o){f[e].m(n,o),_(n,i,o),c=!0},p(n,[o]){let u=e;e=a(n),e===u?f[e].p(n,o):(he(),k(f[u],1,1,()=>{f[u]=null}),_e(),s=f[e],s?s.p(n,o):(s=f[e]=r[e](n),s.c()),C(s,1),s.m(i.parentNode,i))},i(n){c||(C(s),c=!0)},o(n){k(s),c=!1},d(n){f[e].d(n),n&&h(i)}}}function Ee(){const t=window.location.href.indexOf("#/");let e=t>-1?window.location.href.substr(t+1):"/";const s=e.indexOf("?");let i="";return s>-1&&(i=e.substr(s+1),e=e.substr(0,s)),{location:e,querystring:i}}const pe=Ne(null,function(e){e(Ee());const s=()=>{e(Ee())};return window.addEventListener("hashchange",s,!1),function(){window.removeEventListener("hashchange",s,!1)}});Ue(pe,t=>t.location);Ue(pe,t=>t.querystring);const xe=F(void 0);async function K(t){if(!t||t.length<1||t.charAt(0)!="/"&&t.indexOf("#/")!==0)throw Error("Invalid parameter location");await Ae(),history.replaceState(be(ye({},history.state),{__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY}),void 0,void 0),window.location.hash=(t.charAt(0)=="#"?"":"#")+t}function lt(t,e,s){let{routes:i={}}=e,{prefix:c=""}=e,{restoreScrollState:r=!1}=e;class f{constructor(g,w){if(!w||typeof w!="function"&&(typeof w!="object"||w._sveltesparouter!==!0))throw Error("Invalid component object");if(!g||typeof g=="string"&&(g.length<1||g.charAt(0)!="/"&&g.charAt(0)!="*")||typeof g=="object"&&!(g instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:T,keys:$}=ot(g);this.path=g,typeof w=="object"&&w._sveltesparouter===!0?(this.component=w.component,this.conditions=w.conditions||[],this.userData=w.userData,this.props=w.props||{}):(this.component=()=>Promise.resolve(w),this.conditions=[],this.props={}),this._pattern=T,this._keys=$}match(g){if(c){if(typeof c=="string")if(g.startsWith(c))g=g.substr(c.length)||"/";else return null;else if(c instanceof RegExp){const A=g.match(c);if(A&&A[0])g=g.substr(A[0].length)||"/";else return null}}const w=this._pattern.exec(g);if(w===null)return null;if(this._keys===!1)return w;const T={};let $=0;for(;$<this._keys.length;){try{T[this._keys[$]]=decodeURIComponent(w[$+1]||"")||null}catch{T[this._keys[$]]=null}$++}return T}async checkConditions(g){for(let w=0;w<this.conditions.length;w++)if(!await this.conditions[w](g))return!1;return!0}}const a=[];i instanceof Map?i.forEach((y,g)=>{a.push(new f(g,y))}):Object.keys(i).forEach(y=>{a.push(new f(y,i[y]))});let n=null,o=null,u={};const l=nt();async function d(y,g){await Ae(),l(y,g)}let p=null,b=null;r&&(b=y=>{y.state&&y.state.__svelte_spa_router_scrollY?p=y.state:p=null},window.addEventListener("popstate",b),et(()=>{p?window.scrollTo(p.__svelte_spa_router_scrollX,p.__svelte_spa_router_scrollY):window.scrollTo(0,0)}));let P=null,j=null;const L=pe.subscribe(async y=>{P=y;let g=0;for(;g<a.length;){const w=a[g].match(y.location);if(!w){g++;continue}const T={route:a[g].path,location:y.location,querystring:y.querystring,userData:a[g].userData,params:w&&typeof w=="object"&&Object.keys(w).length?w:null};if(!await a[g].checkConditions(T)){s(0,n=null),j=null,d("conditionsFailed",T);return}d("routeLoading",Object.assign({},T));const $=a[g].component;if(j!=$){$.loading?(s(0,n=$.loading),j=$,s(1,o=$.loadingParams),s(2,u={}),d("routeLoaded",Object.assign({},T,{component:n,name:n.name,params:o}))):(s(0,n=null),j=null);const A=await $();if(y!=P)return;s(0,n=A&&A.default||A),j=$}w&&typeof w=="object"&&Object.keys(w).length?s(1,o=w):s(1,o=null),s(2,u=a[g].props),d("routeLoaded",Object.assign({},T,{component:n,name:n.name,params:o})).then(()=>{xe.set(o)});return}s(0,n=null),j=null,xe.set(void 0)});tt(()=>{L(),b&&window.removeEventListener("popstate",b)});function Z(y){re.call(this,t,y)}function ee(y){re.call(this,t,y)}return t.$$set=y=>{"routes"in y&&s(3,i=y.routes),"prefix"in y&&s(4,c=y.prefix),"restoreScrollState"in y&&s(5,r=y.restoreScrollState)},t.$$.update=()=>{t.$$.dirty&32&&(history.scrollRestoration=r?"manual":"auto")},[n,o,u,i,c,r,Z,ee]}class ut extends I{constructor(e){super(),D(this,e,lt,at,R,{routes:3,prefix:4,restoreScrollState:5})}}let We=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,s)=>(s&=63,s<36?e+=s.toString(36):s<62?e+=(s-26).toString(36).toUpperCase():s>62?e+="-":e+="_",e),"");var ft=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},le={exports:{}};(function(t,e){(function(s,i){i(e)})(ft,function(s){function i(){const a=window.navigator.userAgent.toLocaleLowerCase();return a.indexOf("edge")!==-1?"edge":a.indexOf("chrome")!==-1&&a.indexOf("edge")===-1?"chrome":a.indexOf("safari")!==-1&&a.indexOf("chrome")===-1?"safari":a.indexOf("opera")!==-1?"opera":a.indexOf("firefox")!==-1?"firefox":"unknown"}function c(a,n){let o="";o=a==="VP8"?"video/VP8":a==="VP9"?"video/VP9":a==="H264"?"video/H264":`video/${a}`;const u=n.filter(l=>l.mimeType==o);if(u.length<1)throw new Error("invalid video codec type");return u}class r extends class{constructor(n,o,u,l=!1,d=!1){this.debug=l,this.roomId=o,this.signalingUrl=n,this.options=u,this._removeCodec=!1,this.stream=null,this.remoteStream=null,this._pc=null,this._ws=null,this.authnMetadata=null,this.authzMetadata=null,this._dataChannels=[],this._isOffer=!1,this._isExistUser=!1,this.connectionState="new",this._pcConfig={iceServers:this.options.iceServers,iceTransportPolicy:d?"relay":"all"},this._callbacks={open:()=>{},connect:()=>{},disconnect:()=>{},addstream:()=>{},removestream:()=>{},bye:()=>{},datachannel:()=>{}}}on(n,o){n in this._callbacks&&(this._callbacks[n]=o)}async _disconnect(){await this._dataChannels.forEach(async n=>{await this._closeDataChannel(n)}),await this._closePeerConnection(),await this._closeWebSocketConnection(),this.authzMetadata=null,this._removeCodec=!1,this._isOffer=!1,this._isExistUser=!1,this._dataChannels=[],this.connectionState="new"}async _signaling(){return new Promise((n,o)=>{if(this._ws)return o("WS-ALREADY-EXISTS");this._ws=new WebSocket(this.signalingUrl),this._ws.onclose=async()=>(await this._disconnect(),this._callbacks.disconnect({reason:"WS-CLOSED"}),o("WS-CLOSED")),this._ws.onerror=async()=>(await this._disconnect(),o("WS-CLOSED-WITH-ERROR")),this._ws.onopen=()=>{const u={type:"register",roomId:this.roomId,clientId:this.options.clientId,authnMetadata:void 0,key:void 0};this.authnMetadata!==null&&(u.authnMetadata=this.authnMetadata),this.options.signalingKey!==null&&(u.key=this.options.signalingKey),this._sendWs(u),this._ws&&(this._ws.onmessage=async l=>{try{if(typeof l.data!="string")return;const d=JSON.parse(l.data);if(d.type==="ping")this._sendWs({type:"pong"});else{if(d.type==="bye")return this._callbacks.bye(l),n();if(d.type==="accept")return this.authzMetadata=d.authzMetadata,Array.isArray(d.iceServers)&&d.iceServers.length>0&&(this._traceLog("iceServers=>",d.iceServers),this._pcConfig.iceServers=d.iceServers),this._traceLog("isExistUser=>",d.isExistUser),this._isExistUser=d.isExistUser,this._createPeerConnection(),this._isExistUser===!0&&await this._sendOffer(),n();if(d.type==="reject")return await this._disconnect(),this._callbacks.disconnect({reason:d.reason||"REJECTED"}),o("REJECTED");if(d.type==="offer")this._pc&&this._pc.signalingState==="have-local-offer"&&this._createPeerConnection(),this._setOffer(new RTCSessionDescription(d));else if(d.type==="answer")await this._setAnswer(new RTCSessionDescription(d));else if(d.type==="candidate"&&d.ice){this._traceLog("Received ICE candidate ...",d.ice);const p=new RTCIceCandidate(d.ice);this._addIceCandidate(p)}}}catch(d){await this._disconnect(),this._callbacks.disconnect({reason:"SIGNALING-ERROR",error:d})}})}})}_createPeerConnection(){this._traceLog("RTCConfiguration=>",this._pcConfig);const n=new RTCPeerConnection(this._pcConfig),o=this.stream&&this.stream.getAudioTracks()[0];o&&this.options.audio.direction!=="recvonly"?n.addTrack(o,this.stream):this.options.audio.enabled&&n.addTransceiver("audio",{direction:"recvonly"});const u=this.stream&&this.stream.getVideoTracks()[0];if(u&&this.options.video.direction!=="recvonly"){const d=n.addTrack(u,this.stream),p=this._getTransceiver(n,d);if(this._isVideoCodecSpecified()&&p!==null)if(p.setCodecPreferences!==void 0){const b=RTCRtpSender.getCapabilities("video");if(b){let P=[];this.options.video.codec&&(P=c(this.options.video.codec,b.codecs)),this._traceLog("video codecs=",P),p.setCodecPreferences(P)}}else this._removeCodec=!0}else if(this.options.video.enabled){const d=n.addTransceiver("video",{direction:"recvonly"});if(this._isVideoCodecSpecified())if(d.setCodecPreferences!==void 0){const p=RTCRtpSender.getCapabilities("video");if(p){let b=[];this.options.video.codec&&(b=c(this.options.video.codec,p.codecs)),this._traceLog("video codecs=",b),d.setCodecPreferences(b)}}else this._removeCodec=!0}const l=[];n.ontrack=d=>{const p=d;if(this._traceLog("peer.ontrack()",d),i()==="safari"){l.push(d.track);const b=new MediaStream(l);this.remoteStream=b}else this.remoteStream=d.streams[0];p.stream=this.remoteStream,this._callbacks.addstream(p)},n.onicecandidate=d=>{this._traceLog("peer.onicecandidate()",d),d.candidate?this._sendIceCandidate(d.candidate):this._traceLog("empty ice event","")},n.oniceconnectionstatechange=async()=>{if(this._traceLog("ICE connection Status has changed to ",n.iceConnectionState),this.connectionState!==n.iceConnectionState)switch(this.connectionState=n.iceConnectionState,this.connectionState){case"connected":this._isOffer=!1,this._callbacks.connect();break;case"disconnected":case"failed":await this._disconnect(),this._callbacks.disconnect({reason:"ICE-CONNECTION-STATE-FAILED"})}},n.onsignalingstatechange=d=>{this._traceLog("signaling state changes:",n.signalingState)},n.ondatachannel=this._onDataChannel.bind(this),this._pc?this._pc=n:(this._pc=n,this._callbacks.open({authzMetadata:this.authzMetadata}))}async _createDataChannel(n,o){return new Promise((u,l)=>{if(!this._pc)return l("PeerConnection Does Not Ready");if(this._isOffer)return l("PeerConnection Has Local Offer");let d=this._findDataChannel(n);return d?l("DataChannel Already Exists!"):this._isExistUser?(d=this._pc.createDataChannel(n,o),d.onclose=p=>{this._traceLog("datachannel onclosed=>",p),this._dataChannels=this._dataChannels.filter(b=>b.label!=n)},d.onerror=p=>{this._traceLog("datachannel onerror=>",p),this._dataChannels=this._dataChannels.filter(b=>b.label!=n)},d.onmessage=p=>{this._traceLog("datachannel onmessage=>",p.data),p.label=n},d.onopen=p=>{this._traceLog("datachannel onopen=>",p)},this._dataChannels.push(d),u(d)):u(null)})}_onDataChannel(n){if(this._traceLog("on data channel",n),!this._pc)return;const o=n.channel,u=n.channel.label;n.channel&&(!u||u.length<1||(o.onopen=async l=>{this._traceLog("datachannel onopen=>",l)},o.onclose=async l=>{this._traceLog("datachannel onclosed=>",l)},o.onerror=async l=>{this._traceLog("datachannel onerror=>",l)},o.onmessage=l=>{this._traceLog("datachannel onmessage=>",l.data),l.label=u},this._findDataChannel(u)?this._dataChannels=this._dataChannels.map(l=>l.label==u?o:l):this._dataChannels.push(n.channel),this._callbacks.datachannel(o)))}async _sendOffer(){if(!this._pc)return;i()==="safari"&&(this.options.video.enabled&&this.options.video.direction==="sendrecv"&&this._pc.addTransceiver("video",{direction:"recvonly"}),this.options.audio.enabled&&this.options.audio.direction==="sendrecv"&&this._pc.addTransceiver("audio",{direction:"recvonly"}));const n=await this._pc.createOffer({offerToReceiveAudio:this.options.audio.enabled&&this.options.audio.direction!=="sendonly",offerToReceiveVideo:this.options.video.enabled&&this.options.video.direction!=="sendonly"});this._removeCodec&&this.options.video.codec&&["VP8","VP9","H264"].forEach(o=>{this.options.video.codec!==o&&(n.sdp=function(u,l){return function d(p){const b=new RegExp("(a=rtpmap:(\\d*) "+l+"/90000\\r\\n)"),P=p.match(b);if(P==null||P.length<=2)return u;const j=P[2];let L=p.replace(b,"");const Z=new RegExp("(a=rtcp-fb:"+j+`.*\r
)`,"g");L=L.replace(Z,"");const ee=new RegExp("(a=fmtp:"+j+`.*\r
)`,"g");L=L.replace(ee,"");const y=new RegExp("(a=fmtp:(\\d*) apt="+j+"\\r\\n)"),g=L.match(y);let w="";if(g!=null&&g.length>=3){w=g[2],L=L.replace(y,"");const A=new RegExp("(a=rtpmap:"+w+`.*\r
)`,"g");L=L.replace(A,"")}const T=/(m=video.*\r\n)/,$=L.match(T);if($!=null){const A=$[0].substring(0,$[0].length-2).split(" ");let te=A[0];A.forEach((ne,Fe)=>{Fe!==0&&ne!=j&&ne!=w&&(te+=" "+ne)}),te+=`\r
`,L=L.replace(T,te)}return d(L)}(u)}(n.sdp,o))}),this._traceLog("create offer sdp, sdp=",n.sdp),await this._pc.setLocalDescription(n),this._pc.localDescription&&this._sendSdp(this._pc.localDescription),this._isOffer=!0}_isVideoCodecSpecified(){return this.options.video.enabled&&this.options.video.codec!==null}async _createAnswer(){if(this._pc)try{const n=await this._pc.createAnswer();this._traceLog("create answer sdp, sdp=",n.sdp),await this._pc.setLocalDescription(n),this._pc.localDescription&&this._sendSdp(this._pc.localDescription)}catch(n){await this._disconnect(),this._callbacks.disconnect({reason:"CREATE-ANSWER-ERROR",error:n})}}async _setAnswer(n){this._pc&&(await this._pc.setRemoteDescription(n),this._traceLog("set answer sdp=",n.sdp))}async _setOffer(n){try{if(!this._pc)return;await this._pc.setRemoteDescription(n),this._traceLog("set offer sdp=",n.sdp),await this._createAnswer()}catch(o){await this._disconnect(),this._callbacks.disconnect({reason:"SET-OFFER-ERROR",error:o})}}async _addIceCandidate(n){try{this._pc&&await this._pc.addIceCandidate(n)}catch{this._traceLog("invalid ice candidate",n)}}_sendIceCandidate(n){const o={type:"candidate",ice:n};this._sendWs(o)}_sendSdp(n){this._sendWs(n)}_sendWs(n){this._ws&&this._ws.send(JSON.stringify(n))}_getTransceiver(n,o){let u=null;if(n.getTransceivers().forEach(l=>{l.sender!=o&&l.receiver!=o||(u=l)}),!u)throw new Error("invalid transceiver");return u}_findDataChannel(n){return this._dataChannels.find(o=>o.label==n)}async _closeDataChannel(n){return new Promise(o=>{if(n.readyState==="closed")return o();n.onclose=null;const u=setInterval(()=>{if(n.readyState==="closed")return clearInterval(u),o()},400);n&&n.close()})}async _closePeerConnection(){return new Promise(n=>{if(i()==="safari"&&this._pc)return this._pc.oniceconnectionstatechange=()=>{},this._pc.close(),this._pc=null,n();if(!this._pc)return n();if(this._pc&&this._pc.signalingState=="closed")return this._pc=null,n();this._pc.oniceconnectionstatechange=()=>{};const o=setInterval(()=>this._pc?this._pc&&this._pc.signalingState=="closed"?(this._pc=null,clearInterval(o),n()):void 0:(clearInterval(o),n()),400);this._pc.close()})}async _closeWebSocketConnection(){return new Promise(n=>{if(!this._ws)return n();if(this._ws&&this._ws.readyState===3)return this._ws=null,n();this._ws.onclose=()=>{};const o=setInterval(()=>this._ws?this._ws.readyState===3?(this._ws=null,clearInterval(o),n()):void 0:(clearInterval(o),n()),400);this._ws&&this._ws.close()})}_traceLog(n,o){this.debug&&function(u,l){let d="";window.performance&&(d="[Ayame "+(window.performance.now()/1e3).toFixed(3)+"]"),i()==="edge"?console.log(d+" "+u+`
`,l):console.info(d+" "+u+`
`,l)}(n,o)}}{constructor(n,o,u,l=!1,d=!1){super(n,o,u,l,d)}async connect(n,o=null){if(this._ws||this._pc)throw this._traceLog("connection already exists"),new Error("Connection Already Exists!");this.stream=n,o&&(this.authnMetadata=o.authnMetadata),await this._signaling()}async createDataChannel(n,o){return await this._createDataChannel(n,o)}async removeDataChannel(n){this._traceLog("datachannel remove=>",n);const o=this._findDataChannel(n);if(!o||o.readyState!=="open")throw new Error("data channel is not exist or open");await this._closeDataChannel(o)}async disconnect(){return new Promise(n=>(this._ws&&this._ws.close(),n()))}}const f={audio:{direction:"sendrecv",enabled:!0},video:{direction:"sendrecv",enabled:!0},iceServers:[],clientId:function(a){const n=[],o="0123456789";for(;a--;)n.push(o.charAt(Math.floor(Math.random()*o.length)));return n.join("")}(17)};s.connection=function(a,n,o=f,u=!1,l=!1){return new r(a,n,o,u,l)},s.defaultOptions=f,s.version=function(){return process.version},Object.defineProperty(s,"__esModule",{value:!0})})})(le,le.exports);const dt="wss://ayame-labo.shiguredo.app/signaling",He=F(),Q=F(),Ve=F();async function ze(){var t;ht(),await((t=Re(He))==null?void 0:t.disconnect())}async function qe(t){const e=`one-on-one-jp-${t}`,s=le.exports.connection(dt,e),i=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});await s.connect(i),s.on("disconnect",console.log),s.on("addstream",c=>{Ve.set(c.stream)}),He.set(s),Q.set(i)}function ht(){var t;(t=Re(Q))==null||t.getTracks().forEach(e=>e.stop())}function ue(t,e){return t.srcObject=e,{update(s){t.srcObject!==s&&(t.srcObject=s)},destroy(){}}}function _t(t){let e,s,i,c,r,f;return{c(){e=v("video"),i=E(),c=v("button"),c.textContent="\u9000\u5BA4\u3059\u308B",e.autoplay=!0,e.playsInline=!0},m(a,n){_(a,e,n),_(a,i,n),_(a,c,n),r||(f=[oe(s=ue.call(null,e,t[0])),U(c,"click",t[1])],r=!0)},p(a,[n]){s&&H(s.update)&&n&1&&s.update.call(null,a[0])},i:m,o:m,d(a){a&&h(e),a&&h(i),a&&h(c),r=!1,M(f)}}}function pt(t,e,s){let i;ie(t,Q,r=>s(0,i=r)),De(()=>{qe(We())});function c(){ze(),K("/")}return[i,c]}class mt extends I{constructor(e){super(),D(this,e,pt,_t,R,{})}}function gt(t){let e,s,i;return{c(){e=v("h1"),e.textContent="One on One in \u65E5\u672C!",G(e,"class","svelte-10qdmii")},m(c,r){_(c,e,r),s||(i=U(e,"click",t[0]),s=!0)},p:m,i:m,o:m,d(c){c&&h(e),s=!1,i()}}}function wt(t){function e(s){re.call(this,t,s)}return[e]}class me extends I{constructor(e){super(),D(this,e,wt,gt,R,{})}}function yt(t){let e,s,i,c;return e=new me({}),i=new mt({}),{c(){O(e.$$.fragment),s=E(),O(i.$$.fragment)},m(r,f){x(e,r,f),_(r,s,f),x(i,r,f),c=!0},p:m,i(r){c||(C(e.$$.fragment,r),C(i.$$.fragment,r),c=!0)},o(r){k(e.$$.fragment,r),k(i.$$.fragment,r),c=!1},d(r){S(e,r),r&&h(s),S(i,r)}}}class bt extends I{constructor(e){super(),D(this,e,null,yt,R,{})}}function vt(t){let e,s,i,c,r,f,a,n,o;return{c(){e=v("h2"),e.textContent="\u30EB\u30FC\u30E0",s=E(),i=v("input"),c=E(),r=v("button"),r.textContent="\u5165\u5BA4\u3059\u308B",f=E(),a=v("button"),a.textContent="\u30EB\u30FC\u30E0ID\u751F\u6210",G(i,"type","text"),G(i,"placeholder","\u30EB\u30FC\u30E0ID\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044"),G(i,"class","svelte-gzebfg")},m(u,l){_(u,e,l),_(u,s,l),_(u,i,l),$e(i,t[0]),_(u,c,l),_(u,r,l),_(u,f,l),_(u,a,l),n||(o=[U(i,"input",t[3]),U(r,"click",t[2]),U(a,"click",t[1])],n=!0)},p(u,[l]){l&1&&i.value!==u[0]&&$e(i,u[0])},i:m,o:m,d(u){u&&h(e),u&&h(s),u&&h(i),u&&h(c),u&&h(r),u&&h(f),u&&h(a),n=!1,M(o)}}}function $t(t,e,s){let i="";function c(){s(0,i=We());var a="text/plain",n=new Blob([i],{type:a}),o=[new window.ClipboardItem({[a]:n})];navigator.clipboard.write(o).then(function(){},function(){})}function r(){if(i===""){alert("\u30EB\u30FC\u30E0ID\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044!");return}K(`/room/${i}`)}function f(){i=this.value,s(0,i)}return[i,c,r,f]}class Ct extends I{constructor(e){super(),D(this,e,$t,vt,R,{})}}function kt(t){let e,s,i,c,r,f,a;return{c(){e=v("h2"),e.textContent="\u30AB\u30E1\u30E9\u30FB\u30DE\u30A4\u30AF\u30C1\u30A7\u30C3\u30AF",s=E(),i=v("button"),i.textContent="\u30AB\u30E1\u30E9\u30FB\u30DE\u30A4\u30AF\u30C1\u30A7\u30C3\u30AF",c=E(),r=v("p"),r.textContent="\u203B\u30DE\u30A4\u30AF\u304C\u30B9\u30D4\u30FC\u30AB\u30FC\u97F3\u3092\u62FE\u3046\u3068\u3001\u30CF\u30A6\u30EA\u30F3\u30B0\u3059\u308B\u5834\u5408\u304C\u3042\u308A\u307E\u3059\u3002\u305D\u306E\u5834\u5408\u306F\u4E00\u5EA6\u9000\u5BA4\u3057\u3001\u30B9\u30D4\u30FC\u30AB\u30FC\u97F3\u3092\u5C11\u3057\u843D\u3068\u3057\u305F\u4E0A\u3067\u518D\u5EA6\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002"},m(n,o){_(n,e,o),_(n,s,o),_(n,i,o),_(n,c,o),_(n,r,o),f||(a=U(i,"click",t[0]),f=!0)},p:m,i:m,o:m,d(n){n&&h(e),n&&h(s),n&&h(i),n&&h(c),n&&h(r),f=!1,a()}}}function Et(t){return[()=>K("/checker")]}class xt extends I{constructor(e){super(),D(this,e,Et,kt,R,{})}}function St(t){let e,s,i;return{c(){e=v("h2"),e.textContent="\u6280\u8853\u60C5\u5831",s=E(),i=v("ul"),i.innerHTML=`<li>Signaling Server \u306B
    <a href="https://ayame-labo.shiguredo.app/" target="_blank">Ayame Labo</a>
    \u3092\u5229\u7528\u3057\u3066\u3044\u307E\u3059\u3002</li> 

  <li>\u300COne on One in \u65E5\u672C\u300D\u306E\u30BD\u30FC\u30B9\u30B3\u30FC\u30C9\u306F
    <a href="https://github.com/ampcpmgp/one-on-one" target="_blank">\u3053\u3061\u3089</a></li>`},m(c,r){_(c,e,r),_(c,s,r),_(c,i,r)},p:m,i:m,o:m,d(c){c&&h(e),c&&h(s),c&&h(i)}}}class Ot extends I{constructor(e){super(),D(this,e,null,St,R,{})}}function Rt(t){let e,s,i;return{c(){e=v("h2"),e.textContent="\u4F7F\u3044\u65B9",s=E(),i=v("ul"),i.innerHTML=`<li>\u307E\u305A\u306F\u300C\u30AB\u30E1\u30E9\u30FB\u30DE\u30A4\u30AF\u30C1\u30A7\u30C3\u30AF\u300D\u304B\u3089\u3001\u81EA\u62E0\u70B9\u306E\u6620\u50CF\u3068\u97F3\u58F0\u3092\u78BA\u8A8D\u3092\u3057\u3066\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u78BA\u8A8D\u304C\u7D42\u308F\u308A\u307E\u3057\u305F\u3089\u3001\u300C\u30EB\u30FC\u30E0\u300D\u3088\u308A\u3001\u30EB\u30FC\u30E0ID\u3092\u751F\u6210\u3057\u3066\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u30EB\u30FC\u30E0ID\u751F\u6210\u5F8C\u3001\u30AF\u30EA\u30C3\u30D7\u30DC\u30FC\u30C9\u306BID\u304C\u30B3\u30D4\u30FC\u3055\u308C\u307E\u3059\u3002\u305D\u306EID\u3092\u76F8\u624B\u306B\u304A\u4F1D\u3048\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u53D7\u3051\u53D6\u3063\u305F\u65B9\u306F\u30EB\u30FC\u30E0ID\u3092\u30C6\u30AD\u30B9\u30C8\u6B04\u306B\u5165\u529B\u3057\u3001\u300C\u5165\u5BA4\u3059\u308B\u300D\u30DC\u30BF\u30F3\u3092\u62BC\u3057\u3066\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u304A\u4E92\u3044\u304C\u5165\u5BA4\u3059\u308B\u3068\u30D3\u30C7\u30AA\u901A\u8A71\u304C\u53EF\u80FD\u306B\u306A\u308A\u307E\u3059\u3002</li>`},m(c,r){_(c,e,r),_(c,s,r),_(c,i,r)},p:m,i:m,o:m,d(c){c&&h(e),c&&h(s),c&&h(i)}}}class Lt extends I{constructor(e){super(),D(this,e,null,Rt,R,{})}}function Dt(t){let e,s,i;return{c(){e=v("h2"),e.textContent="\u6982\u8981",s=E(),i=v("ul"),i.innerHTML=`<li>\u3053\u306E\u30A2\u30D7\u30EA\u306F 1:1 \u5C02\u7528\u306E\u30D3\u30C7\u30AA\u901A\u8A71\u30A2\u30D7\u30EA\u3067\u3059\u3002</li> 
  <li>\u65E5\u672C\u56FD\u5916\u304B\u3089\u306F\u3054\u5229\u7528\u3067\u304D\u307E\u305B\u3093\u3002</li> 
  <li>\u540C\u50DA\u3084\u53CB\u4EBA\u3068\u304A\u4F7F\u3044\u304F\u3060\u3055\u3044\u3002\u4E0D\u7279\u5B9A\u591A\u6570\u3068\u7E4B\u304C\u308B\u3053\u3068\u306F\u3067\u304D\u307E\u305B\u3093\u3002</li>`},m(c,r){_(c,e,r),_(c,s,r),_(c,i,r)},p:m,i:m,o:m,d(c){c&&h(e),c&&h(s),c&&h(i)}}}class It extends I{constructor(e){super(),D(this,e,null,Dt,R,{})}}function Tt(t){let e,s,i,c,r,f,a,n,o,u;return e=new It({}),i=new Lt({}),r=new xt({}),a=new Ct({}),o=new Ot({}),{c(){O(e.$$.fragment),s=E(),O(i.$$.fragment),c=E(),O(r.$$.fragment),f=E(),O(a.$$.fragment),n=E(),O(o.$$.fragment)},m(l,d){x(e,l,d),_(l,s,d),x(i,l,d),_(l,c,d),x(r,l,d),_(l,f,d),x(a,l,d),_(l,n,d),x(o,l,d),u=!0},p:m,i(l){u||(C(e.$$.fragment,l),C(i.$$.fragment,l),C(r.$$.fragment,l),C(a.$$.fragment,l),C(o.$$.fragment,l),u=!0)},o(l){k(e.$$.fragment,l),k(i.$$.fragment,l),k(r.$$.fragment,l),k(a.$$.fragment,l),k(o.$$.fragment,l),u=!1},d(l){S(e,l),l&&h(s),S(i,l),l&&h(c),S(r,l),l&&h(f),S(a,l),l&&h(n),S(o,l)}}}class At extends I{constructor(e){super(),D(this,e,null,Tt,R,{})}}function Pt(t){let e,s,i,c;return e=new me({}),i=new At({}),{c(){O(e.$$.fragment),s=E(),O(i.$$.fragment)},m(r,f){x(e,r,f),_(r,s,f),x(i,r,f),c=!0},p:m,i(r){c||(C(e.$$.fragment,r),C(i.$$.fragment,r),c=!0)},o(r){k(e.$$.fragment,r),k(i.$$.fragment,r),c=!1},d(r){S(e,r),r&&h(s),S(i,r)}}}class jt extends I{constructor(e){super(),D(this,e,null,Pt,R,{})}}function Mt(t){let e;return{c(){e=v("p"),e.textContent="404"},m(s,i){_(s,e,i)},p:m,i:m,o:m,d(s){s&&h(e)}}}class Nt extends I{constructor(e){super(),D(this,e,null,Mt,R,{})}}function Ut(t){let e,s,i,c,r,f,a,n,o;return{c(){e=v("video"),i=E(),c=v("video"),f=E(),a=v("button"),a.textContent="\u9000\u5BA4\u3059\u308B",e.muted=!0,e.autoplay=!0,e.playsInline=!0,c.autoplay=!0,c.playsInline=!0},m(u,l){_(u,e,l),_(u,i,l),_(u,c,l),_(u,f,l),_(u,a,l),n||(o=[oe(s=ue.call(null,e,t[0])),oe(r=ue.call(null,c,t[1])),U(a,"click",t[2])],n=!0)},p(u,[l]){s&&H(s.update)&&l&1&&s.update.call(null,u[0]),r&&H(r.update)&&l&2&&r.update.call(null,u[1])},i:m,o:m,d(u){u&&h(e),u&&h(i),u&&h(c),u&&h(f),u&&h(a),n=!1,M(o)}}}function Wt(t,e,s){let i,c;ie(t,Q,a=>s(0,i=a)),ie(t,Ve,a=>s(1,c=a));let{params:r={}}=e;De(()=>{qe(r.id)});function f(){ze(),K("/")}return t.$$set=a=>{"params"in a&&s(3,r=a.params)},[i,c,f,r]}class Ht extends I{constructor(e){super(),D(this,e,Wt,Ut,R,{params:3})}}function Vt(t){let e,s,i,c;return e=new me({}),i=new Ht({}),{c(){O(e.$$.fragment),s=E(),O(i.$$.fragment)},m(r,f){x(e,r,f),_(r,s,f),x(i,r,f),c=!0},p:m,i(r){c||(C(e.$$.fragment,r),C(i.$$.fragment,r),c=!0)},o(r){k(e.$$.fragment,r),k(i.$$.fragment,r),c=!1},d(r){S(e,r),r&&h(s),S(i,r)}}}class zt extends I{constructor(e){super(),D(this,e,null,Vt,R,{})}}var qt={"/":jt,"/checker":bt,"/room/:id":zt,"*":Nt};function Ft(t){let e,s;return e=new ut({props:{routes:qt}}),{c(){O(e.$$.fragment)},m(i,c){x(e,i,c),s=!0},p:m,i(i){s||(C(e.$$.fragment,i),s=!0)},o(i){k(e.$$.fragment,i),s=!1},d(i){S(e,i)}}}class Yt extends I{constructor(e){super(),D(this,e,null,Ft,R,{})}}new Yt({target:document.body});
