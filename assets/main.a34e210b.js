var Ge=Object.defineProperty,Je=Object.defineProperties;var Xe=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable;var ye=(t,e,n)=>e in t?Ge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ve=(t,e)=>{for(var n in e||(e={}))Be.call(e,n)&&ye(t,n,e[n]);if(we)for(var n of we(e))Ke.call(e,n)&&ye(t,n,e[n]);return t},be=(t,e)=>Je(t,Xe(e));function g(){}function Oe(t,e){for(const n in e)t[n]=e[n];return t}function Le(t){return t()}function $e(){return Object.create(null)}function N(t){t.forEach(Le)}function z(t){return typeof t=="function"}function R(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Qe(t){return Object.keys(t).length===0}function de(t,...e){if(t==null)return g;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Re(t){let e;return de(t,n=>e=n)(),e}function oe(t,e,n){t.$$.on_destroy.push(de(e,n))}function re(t){return t&&z(t.destroy)?t.destroy:g}function M(t,e){t.appendChild(e)}function _(t,e,n){t.insertBefore(e,n||null)}function p(t){t.parentNode.removeChild(t)}function b(t){return document.createElement(t)}function De(t){return document.createTextNode(t)}function $(){return De(" ")}function he(){return De("")}function W(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function H(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ze(t){return Array.from(t.childNodes)}function Ce(t,e){t.value=e==null?"":e}function et(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const c=document.createEvent("CustomEvent");return c.initCustomEvent(t,n,i,e),c}let Y;function F(t){Y=t}function K(){if(!Y)throw new Error("Function called outside component initialization");return Y}function Ie(t){K().$$.on_mount.push(t)}function tt(t){K().$$.after_update.push(t)}function nt(t){K().$$.on_destroy.push(t)}function st(){const t=K();return(e,n,{cancelable:i=!1}={})=>{const c=t.$$.callbacks[e];if(c){const r=et(e,n,{cancelable:i});return c.slice().forEach(d=>{d.call(t,r)}),!r.defaultPrevented}return!0}}function ce(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(i=>i.call(this,e))}const q=[],xe=[],X=[],ke=[],Te=Promise.resolve();let ae=!1;function Ae(){ae||(ae=!0,Te.then(je))}function Pe(){return Ae(),Te}function le(t){X.push(t)}const ie=new Set;let J=0;function je(){const t=Y;do{for(;J<q.length;){const e=q[J];J++,F(e),it(e.$$)}for(F(null),q.length=0,J=0;xe.length;)xe.pop()();for(let e=0;e<X.length;e+=1){const n=X[e];ie.has(n)||(ie.add(n),n())}X.length=0}while(q.length);for(;ke.length;)ke.pop()();ae=!1,ie.clear(),F(t)}function it(t){if(t.fragment!==null){t.update(),N(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(le)}}const B=new Set;let U;function pe(){U={r:0,c:[],p:U}}function _e(){U.r||N(U.c),U=U.p}function k(t,e){t&&t.i&&(B.delete(t),t.i(e))}function E(t,e,n,i){if(t&&t.o){if(B.has(t))return;B.add(t),U.c.push(()=>{B.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}}function Me(t,e){const n={},i={},c={$$scope:1};let r=t.length;for(;r--;){const d=t[r],a=e[r];if(a){for(const s in d)s in a||(i[s]=1);for(const s in a)c[s]||(n[s]=a[s],c[s]=1);t[r]=a}else for(const s in d)c[s]=1}for(const d in i)d in n||(n[d]=void 0);return n}function Ne(t){return typeof t=="object"&&t!==null?t:{}}function L(t){t&&t.c()}function S(t,e,n,i){const{fragment:c,on_mount:r,on_destroy:d,after_update:a}=t.$$;c&&c.m(e,n),i||le(()=>{const s=r.map(Le).filter(z);d?d.push(...s):N(s),t.$$.on_mount=[]}),a.forEach(le)}function O(t,e){const n=t.$$;n.fragment!==null&&(N(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function ot(t,e){t.$$.dirty[0]===-1&&(q.push(t),Ae(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function I(t,e,n,i,c,r,d,a=[-1]){const s=Y;F(t);const o=t.$$={fragment:null,ctx:null,props:r,update:g,not_equal:c,bound:$e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(s?s.$$.context:[])),callbacks:$e(),dirty:a,skip_bound:!1,root:e.target||s.$$.root};d&&d(o.root);let f=!1;if(o.ctx=n?n(t,e.props||{},(l,u,...h)=>{const m=h.length?h[0]:u;return o.ctx&&c(o.ctx[l],o.ctx[l]=m)&&(!o.skip_bound&&o.bound[l]&&o.bound[l](m),f&&ot(t,l)),u}):[],o.update(),f=!0,N(o.before_update),o.fragment=i?i(o.ctx):!1,e.target){if(e.hydrate){const l=Ze(e.target);o.fragment&&o.fragment.l(l),l.forEach(p)}else o.fragment&&o.fragment.c();e.intro&&k(t.$$.fragment),S(t,e.target,e.anchor,e.customElement),je()}F(s)}class T{$destroy(){O(this,1),this.$destroy=g}$on(e,n){const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const c=i.indexOf(n);c!==-1&&i.splice(c,1)}}$set(e){this.$$set&&!Qe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const V=[];function Ue(t,e){return{subscribe:G(t,e).subscribe}}function G(t,e=g){let n;const i=new Set;function c(a){if(R(t,a)&&(t=a,n)){const s=!V.length;for(const o of i)o[1](),V.push(o,t);if(s){for(let o=0;o<V.length;o+=2)V[o][0](V[o+1]);V.length=0}}}function r(a){c(a(t))}function d(a,s=g){const o=[a,s];return i.add(o),i.size===1&&(n=e(c)||g),a(t),()=>{i.delete(o),i.size===0&&(n(),n=null)}}return{set:c,update:r,subscribe:d}}function We(t,e,n){const i=!Array.isArray(t),c=i?[t]:t,r=e.length<2;return Ue(n,d=>{let a=!1;const s=[];let o=0,f=g;const l=()=>{if(o)return;f();const h=e(i?s[0]:s,d);r?d(h):f=z(h)?h:g},u=c.map((h,m)=>de(h,C=>{s[m]=C,o&=~(1<<m),a&&l()},()=>{o|=1<<m}));return a=!0,l(),function(){N(u),f()}})}function rt(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var n,i,c,r,d=[],a="",s=t.split("/");for(s[0]||s.shift();c=s.shift();)n=c[0],n==="*"?(d.push("wild"),a+="/(.*)"):n===":"?(i=c.indexOf("?",1),r=c.indexOf(".",1),d.push(c.substring(1,~i?i:~r?r:c.length)),a+=!!~i&&!~r?"(?:/([^/]+?))?":"/([^/]+?)",~r&&(a+=(~i?"?":"")+"\\"+c.substring(r))):a+="/"+c;return{keys:d,pattern:new RegExp("^"+a+(e?"(?=$|/)":"/?$"),"i")}}function ct(t){let e,n,i;const c=[t[2]];var r=t[0];function d(a){let s={};for(let o=0;o<c.length;o+=1)s=Oe(s,c[o]);return{props:s}}return r&&(e=new r(d()),e.$on("routeEvent",t[7])),{c(){e&&L(e.$$.fragment),n=he()},m(a,s){e&&S(e,a,s),_(a,n,s),i=!0},p(a,s){const o=s&4?Me(c,[Ne(a[2])]):{};if(r!==(r=a[0])){if(e){pe();const f=e;E(f.$$.fragment,1,0,()=>{O(f,1)}),_e()}r?(e=new r(d()),e.$on("routeEvent",a[7]),L(e.$$.fragment),k(e.$$.fragment,1),S(e,n.parentNode,n)):e=null}else r&&e.$set(o)},i(a){i||(e&&k(e.$$.fragment,a),i=!0)},o(a){e&&E(e.$$.fragment,a),i=!1},d(a){a&&p(n),e&&O(e,a)}}}function at(t){let e,n,i;const c=[{params:t[1]},t[2]];var r=t[0];function d(a){let s={};for(let o=0;o<c.length;o+=1)s=Oe(s,c[o]);return{props:s}}return r&&(e=new r(d()),e.$on("routeEvent",t[6])),{c(){e&&L(e.$$.fragment),n=he()},m(a,s){e&&S(e,a,s),_(a,n,s),i=!0},p(a,s){const o=s&6?Me(c,[s&2&&{params:a[1]},s&4&&Ne(a[2])]):{};if(r!==(r=a[0])){if(e){pe();const f=e;E(f.$$.fragment,1,0,()=>{O(f,1)}),_e()}r?(e=new r(d()),e.$on("routeEvent",a[6]),L(e.$$.fragment),k(e.$$.fragment,1),S(e,n.parentNode,n)):e=null}else r&&e.$set(o)},i(a){i||(e&&k(e.$$.fragment,a),i=!0)},o(a){e&&E(e.$$.fragment,a),i=!1},d(a){a&&p(n),e&&O(e,a)}}}function lt(t){let e,n,i,c;const r=[at,ct],d=[];function a(s,o){return s[1]?0:1}return e=a(t),n=d[e]=r[e](t),{c(){n.c(),i=he()},m(s,o){d[e].m(s,o),_(s,i,o),c=!0},p(s,[o]){let f=e;e=a(s),e===f?d[e].p(s,o):(pe(),E(d[f],1,1,()=>{d[f]=null}),_e(),n=d[e],n?n.p(s,o):(n=d[e]=r[e](s),n.c()),k(n,1),n.m(i.parentNode,i))},i(s){c||(k(n),c=!0)},o(s){E(n),c=!1},d(s){d[e].d(s),s&&p(i)}}}function Ee(){const t=window.location.href.indexOf("#/");let e=t>-1?window.location.href.substr(t+1):"/";const n=e.indexOf("?");let i="";return n>-1&&(i=e.substr(n+1),e=e.substr(0,n)),{location:e,querystring:i}}const me=Ue(null,function(e){e(Ee());const n=()=>{e(Ee())};return window.addEventListener("hashchange",n,!1),function(){window.removeEventListener("hashchange",n,!1)}});We(me,t=>t.location);We(me,t=>t.querystring);const Se=G(void 0);async function Q(t){if(!t||t.length<1||t.charAt(0)!="/"&&t.indexOf("#/")!==0)throw Error("Invalid parameter location");await Pe(),history.replaceState(be(ve({},history.state),{__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY}),void 0,void 0),window.location.hash=(t.charAt(0)=="#"?"":"#")+t}function ut(t,e,n){let{routes:i={}}=e,{prefix:c=""}=e,{restoreScrollState:r=!1}=e;class d{constructor(w,y){if(!y||typeof y!="function"&&(typeof y!="object"||y._sveltesparouter!==!0))throw Error("Invalid component object");if(!w||typeof w=="string"&&(w.length<1||w.charAt(0)!="/"&&w.charAt(0)!="*")||typeof w=="object"&&!(w instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:A,keys:x}=rt(w);this.path=w,typeof y=="object"&&y._sveltesparouter===!0?(this.component=y.component,this.conditions=y.conditions||[],this.userData=y.userData,this.props=y.props||{}):(this.component=()=>Promise.resolve(y),this.conditions=[],this.props={}),this._pattern=A,this._keys=x}match(w){if(c){if(typeof c=="string")if(w.startsWith(c))w=w.substr(c.length)||"/";else return null;else if(c instanceof RegExp){const P=w.match(c);if(P&&P[0])w=w.substr(P[0].length)||"/";else return null}}const y=this._pattern.exec(w);if(y===null)return null;if(this._keys===!1)return y;const A={};let x=0;for(;x<this._keys.length;){try{A[this._keys[x]]=decodeURIComponent(y[x+1]||"")||null}catch{A[this._keys[x]]=null}x++}return A}async checkConditions(w){for(let y=0;y<this.conditions.length;y++)if(!await this.conditions[y](w))return!1;return!0}}const a=[];i instanceof Map?i.forEach((v,w)=>{a.push(new d(w,v))}):Object.keys(i).forEach(v=>{a.push(new d(v,i[v]))});let s=null,o=null,f={};const l=st();async function u(v,w){await Pe(),l(v,w)}let h=null,m=null;r&&(m=v=>{v.state&&v.state.__svelte_spa_router_scrollY?h=v.state:h=null},window.addEventListener("popstate",m),tt(()=>{h?window.scrollTo(h.__svelte_spa_router_scrollX,h.__svelte_spa_router_scrollY):window.scrollTo(0,0)}));let C=null,j=null;const D=me.subscribe(async v=>{C=v;let w=0;for(;w<a.length;){const y=a[w].match(v.location);if(!y){w++;continue}const A={route:a[w].path,location:v.location,querystring:v.querystring,userData:a[w].userData,params:y&&typeof y=="object"&&Object.keys(y).length?y:null};if(!await a[w].checkConditions(A)){n(0,s=null),j=null,u("conditionsFailed",A);return}u("routeLoading",Object.assign({},A));const x=a[w].component;if(j!=x){x.loading?(n(0,s=x.loading),j=x,n(1,o=x.loadingParams),n(2,f={}),u("routeLoaded",Object.assign({},A,{component:s,name:s.name,params:o}))):(n(0,s=null),j=null);const P=await x();if(v!=C)return;n(0,s=P&&P.default||P),j=x}y&&typeof y=="object"&&Object.keys(y).length?n(1,o=y):n(1,o=null),n(2,f=a[w].props),u("routeLoaded",Object.assign({},A,{component:s,name:s.name,params:o})).then(()=>{Se.set(o)});return}n(0,s=null),j=null,Se.set(void 0)});nt(()=>{D(),m&&window.removeEventListener("popstate",m)});function ee(v){ce.call(this,t,v)}function te(v){ce.call(this,t,v)}return t.$$set=v=>{"routes"in v&&n(3,i=v.routes),"prefix"in v&&n(4,c=v.prefix),"restoreScrollState"in v&&n(5,r=v.restoreScrollState)},t.$$.update=()=>{t.$$.dirty&32&&(history.scrollRestoration=r?"manual":"auto")},[s,o,f,i,c,r,ee,te]}class ft extends T{constructor(e){super(),I(this,e,ut,lt,R,{routes:3,prefix:4,restoreScrollState:5})}}let He=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");var dt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ue={exports:{}};(function(t,e){(function(n,i){i(e)})(dt,function(n){function i(){const a=window.navigator.userAgent.toLocaleLowerCase();return a.indexOf("edge")!==-1?"edge":a.indexOf("chrome")!==-1&&a.indexOf("edge")===-1?"chrome":a.indexOf("safari")!==-1&&a.indexOf("chrome")===-1?"safari":a.indexOf("opera")!==-1?"opera":a.indexOf("firefox")!==-1?"firefox":"unknown"}function c(a,s){let o="";o=a==="VP8"?"video/VP8":a==="VP9"?"video/VP9":a==="H264"?"video/H264":`video/${a}`;const f=s.filter(l=>l.mimeType==o);if(f.length<1)throw new Error("invalid video codec type");return f}class r extends class{constructor(s,o,f,l=!1,u=!1){this.debug=l,this.roomId=o,this.signalingUrl=s,this.options=f,this._removeCodec=!1,this.stream=null,this.remoteStream=null,this._pc=null,this._ws=null,this.authnMetadata=null,this.authzMetadata=null,this._dataChannels=[],this._isOffer=!1,this._isExistUser=!1,this.connectionState="new",this._pcConfig={iceServers:this.options.iceServers,iceTransportPolicy:u?"relay":"all"},this._callbacks={open:()=>{},connect:()=>{},disconnect:()=>{},addstream:()=>{},removestream:()=>{},bye:()=>{},datachannel:()=>{}}}on(s,o){s in this._callbacks&&(this._callbacks[s]=o)}async _disconnect(){await this._dataChannels.forEach(async s=>{await this._closeDataChannel(s)}),await this._closePeerConnection(),await this._closeWebSocketConnection(),this.authzMetadata=null,this._removeCodec=!1,this._isOffer=!1,this._isExistUser=!1,this._dataChannels=[],this.connectionState="new"}async _signaling(){return new Promise((s,o)=>{if(this._ws)return o("WS-ALREADY-EXISTS");this._ws=new WebSocket(this.signalingUrl),this._ws.onclose=async()=>(await this._disconnect(),this._callbacks.disconnect({reason:"WS-CLOSED"}),o("WS-CLOSED")),this._ws.onerror=async()=>(await this._disconnect(),o("WS-CLOSED-WITH-ERROR")),this._ws.onopen=()=>{const f={type:"register",roomId:this.roomId,clientId:this.options.clientId,authnMetadata:void 0,key:void 0};this.authnMetadata!==null&&(f.authnMetadata=this.authnMetadata),this.options.signalingKey!==null&&(f.key=this.options.signalingKey),this._sendWs(f),this._ws&&(this._ws.onmessage=async l=>{try{if(typeof l.data!="string")return;const u=JSON.parse(l.data);if(u.type==="ping")this._sendWs({type:"pong"});else{if(u.type==="bye")return this._callbacks.bye(l),s();if(u.type==="accept")return this.authzMetadata=u.authzMetadata,Array.isArray(u.iceServers)&&u.iceServers.length>0&&(this._traceLog("iceServers=>",u.iceServers),this._pcConfig.iceServers=u.iceServers),this._traceLog("isExistUser=>",u.isExistUser),this._isExistUser=u.isExistUser,this._createPeerConnection(),this._isExistUser===!0&&await this._sendOffer(),s();if(u.type==="reject")return await this._disconnect(),this._callbacks.disconnect({reason:u.reason||"REJECTED"}),o("REJECTED");if(u.type==="offer")this._pc&&this._pc.signalingState==="have-local-offer"&&this._createPeerConnection(),this._setOffer(new RTCSessionDescription(u));else if(u.type==="answer")await this._setAnswer(new RTCSessionDescription(u));else if(u.type==="candidate"&&u.ice){this._traceLog("Received ICE candidate ...",u.ice);const h=new RTCIceCandidate(u.ice);this._addIceCandidate(h)}}}catch(u){await this._disconnect(),this._callbacks.disconnect({reason:"SIGNALING-ERROR",error:u})}})}})}_createPeerConnection(){this._traceLog("RTCConfiguration=>",this._pcConfig);const s=new RTCPeerConnection(this._pcConfig),o=this.stream&&this.stream.getAudioTracks()[0];o&&this.options.audio.direction!=="recvonly"?s.addTrack(o,this.stream):this.options.audio.enabled&&s.addTransceiver("audio",{direction:"recvonly"});const f=this.stream&&this.stream.getVideoTracks()[0];if(f&&this.options.video.direction!=="recvonly"){const u=s.addTrack(f,this.stream),h=this._getTransceiver(s,u);if(this._isVideoCodecSpecified()&&h!==null)if(h.setCodecPreferences!==void 0){const m=RTCRtpSender.getCapabilities("video");if(m){let C=[];this.options.video.codec&&(C=c(this.options.video.codec,m.codecs)),this._traceLog("video codecs=",C),h.setCodecPreferences(C)}}else this._removeCodec=!0}else if(this.options.video.enabled){const u=s.addTransceiver("video",{direction:"recvonly"});if(this._isVideoCodecSpecified())if(u.setCodecPreferences!==void 0){const h=RTCRtpSender.getCapabilities("video");if(h){let m=[];this.options.video.codec&&(m=c(this.options.video.codec,h.codecs)),this._traceLog("video codecs=",m),u.setCodecPreferences(m)}}else this._removeCodec=!0}const l=[];s.ontrack=u=>{const h=u;if(this._traceLog("peer.ontrack()",u),i()==="safari"){l.push(u.track);const m=new MediaStream(l);this.remoteStream=m}else this.remoteStream=u.streams[0];h.stream=this.remoteStream,this._callbacks.addstream(h)},s.onicecandidate=u=>{this._traceLog("peer.onicecandidate()",u),u.candidate?this._sendIceCandidate(u.candidate):this._traceLog("empty ice event","")},s.oniceconnectionstatechange=async()=>{if(this._traceLog("ICE connection Status has changed to ",s.iceConnectionState),this.connectionState!==s.iceConnectionState)switch(this.connectionState=s.iceConnectionState,this.connectionState){case"connected":this._isOffer=!1,this._callbacks.connect();break;case"disconnected":case"failed":await this._disconnect(),this._callbacks.disconnect({reason:"ICE-CONNECTION-STATE-FAILED"})}},s.onsignalingstatechange=u=>{this._traceLog("signaling state changes:",s.signalingState)},s.ondatachannel=this._onDataChannel.bind(this),this._pc?this._pc=s:(this._pc=s,this._callbacks.open({authzMetadata:this.authzMetadata}))}async _createDataChannel(s,o){return new Promise((f,l)=>{if(!this._pc)return l("PeerConnection Does Not Ready");if(this._isOffer)return l("PeerConnection Has Local Offer");let u=this._findDataChannel(s);return u?l("DataChannel Already Exists!"):this._isExistUser?(u=this._pc.createDataChannel(s,o),u.onclose=h=>{this._traceLog("datachannel onclosed=>",h),this._dataChannels=this._dataChannels.filter(m=>m.label!=s)},u.onerror=h=>{this._traceLog("datachannel onerror=>",h),this._dataChannels=this._dataChannels.filter(m=>m.label!=s)},u.onmessage=h=>{this._traceLog("datachannel onmessage=>",h.data),h.label=s},u.onopen=h=>{this._traceLog("datachannel onopen=>",h)},this._dataChannels.push(u),f(u)):f(null)})}_onDataChannel(s){if(this._traceLog("on data channel",s),!this._pc)return;const o=s.channel,f=s.channel.label;s.channel&&(!f||f.length<1||(o.onopen=async l=>{this._traceLog("datachannel onopen=>",l)},o.onclose=async l=>{this._traceLog("datachannel onclosed=>",l)},o.onerror=async l=>{this._traceLog("datachannel onerror=>",l)},o.onmessage=l=>{this._traceLog("datachannel onmessage=>",l.data),l.label=f},this._findDataChannel(f)?this._dataChannels=this._dataChannels.map(l=>l.label==f?o:l):this._dataChannels.push(s.channel),this._callbacks.datachannel(o)))}async _sendOffer(){if(!this._pc)return;i()==="safari"&&(this.options.video.enabled&&this.options.video.direction==="sendrecv"&&this._pc.addTransceiver("video",{direction:"recvonly"}),this.options.audio.enabled&&this.options.audio.direction==="sendrecv"&&this._pc.addTransceiver("audio",{direction:"recvonly"}));const s=await this._pc.createOffer({offerToReceiveAudio:this.options.audio.enabled&&this.options.audio.direction!=="sendonly",offerToReceiveVideo:this.options.video.enabled&&this.options.video.direction!=="sendonly"});this._removeCodec&&this.options.video.codec&&["VP8","VP9","H264"].forEach(o=>{this.options.video.codec!==o&&(s.sdp=function(f,l){return function u(h){const m=new RegExp("(a=rtpmap:(\\d*) "+l+"/90000\\r\\n)"),C=h.match(m);if(C==null||C.length<=2)return f;const j=C[2];let D=h.replace(m,"");const ee=new RegExp("(a=rtcp-fb:"+j+`.*\r
)`,"g");D=D.replace(ee,"");const te=new RegExp("(a=fmtp:"+j+`.*\r
)`,"g");D=D.replace(te,"");const v=new RegExp("(a=fmtp:(\\d*) apt="+j+"\\r\\n)"),w=D.match(v);let y="";if(w!=null&&w.length>=3){y=w[2],D=D.replace(v,"");const P=new RegExp("(a=rtpmap:"+y+`.*\r
)`,"g");D=D.replace(P,"")}const A=/(m=video.*\r\n)/,x=D.match(A);if(x!=null){const P=x[0].substring(0,x[0].length-2).split(" ");let ne=P[0];P.forEach((se,Ye)=>{Ye!==0&&se!=j&&se!=y&&(ne+=" "+se)}),ne+=`\r
`,D=D.replace(A,ne)}return u(D)}(f)}(s.sdp,o))}),this._traceLog("create offer sdp, sdp=",s.sdp),await this._pc.setLocalDescription(s),this._pc.localDescription&&this._sendSdp(this._pc.localDescription),this._isOffer=!0}_isVideoCodecSpecified(){return this.options.video.enabled&&this.options.video.codec!==null}async _createAnswer(){if(this._pc)try{const s=await this._pc.createAnswer();this._traceLog("create answer sdp, sdp=",s.sdp),await this._pc.setLocalDescription(s),this._pc.localDescription&&this._sendSdp(this._pc.localDescription)}catch(s){await this._disconnect(),this._callbacks.disconnect({reason:"CREATE-ANSWER-ERROR",error:s})}}async _setAnswer(s){this._pc&&(await this._pc.setRemoteDescription(s),this._traceLog("set answer sdp=",s.sdp))}async _setOffer(s){try{if(!this._pc)return;await this._pc.setRemoteDescription(s),this._traceLog("set offer sdp=",s.sdp),await this._createAnswer()}catch(o){await this._disconnect(),this._callbacks.disconnect({reason:"SET-OFFER-ERROR",error:o})}}async _addIceCandidate(s){try{this._pc&&await this._pc.addIceCandidate(s)}catch{this._traceLog("invalid ice candidate",s)}}_sendIceCandidate(s){const o={type:"candidate",ice:s};this._sendWs(o)}_sendSdp(s){this._sendWs(s)}_sendWs(s){this._ws&&this._ws.send(JSON.stringify(s))}_getTransceiver(s,o){let f=null;if(s.getTransceivers().forEach(l=>{l.sender!=o&&l.receiver!=o||(f=l)}),!f)throw new Error("invalid transceiver");return f}_findDataChannel(s){return this._dataChannels.find(o=>o.label==s)}async _closeDataChannel(s){return new Promise(o=>{if(s.readyState==="closed")return o();s.onclose=null;const f=setInterval(()=>{if(s.readyState==="closed")return clearInterval(f),o()},400);s&&s.close()})}async _closePeerConnection(){return new Promise(s=>{if(i()==="safari"&&this._pc)return this._pc.oniceconnectionstatechange=()=>{},this._pc.close(),this._pc=null,s();if(!this._pc)return s();if(this._pc&&this._pc.signalingState=="closed")return this._pc=null,s();this._pc.oniceconnectionstatechange=()=>{};const o=setInterval(()=>this._pc?this._pc&&this._pc.signalingState=="closed"?(this._pc=null,clearInterval(o),s()):void 0:(clearInterval(o),s()),400);this._pc.close()})}async _closeWebSocketConnection(){return new Promise(s=>{if(!this._ws)return s();if(this._ws&&this._ws.readyState===3)return this._ws=null,s();this._ws.onclose=()=>{};const o=setInterval(()=>this._ws?this._ws.readyState===3?(this._ws=null,clearInterval(o),s()):void 0:(clearInterval(o),s()),400);this._ws&&this._ws.close()})}_traceLog(s,o){this.debug&&function(f,l){let u="";window.performance&&(u="[Ayame "+(window.performance.now()/1e3).toFixed(3)+"]"),i()==="edge"?console.log(u+" "+f+`
`,l):console.info(u+" "+f+`
`,l)}(s,o)}}{constructor(s,o,f,l=!1,u=!1){super(s,o,f,l,u)}async connect(s,o=null){if(this._ws||this._pc)throw this._traceLog("connection already exists"),new Error("Connection Already Exists!");this.stream=s,o&&(this.authnMetadata=o.authnMetadata),await this._signaling()}async createDataChannel(s,o){return await this._createDataChannel(s,o)}async removeDataChannel(s){this._traceLog("datachannel remove=>",s);const o=this._findDataChannel(s);if(!o||o.readyState!=="open")throw new Error("data channel is not exist or open");await this._closeDataChannel(o)}async disconnect(){return new Promise(s=>(this._ws&&this._ws.close(),s()))}}const d={audio:{direction:"sendrecv",enabled:!0},video:{direction:"sendrecv",enabled:!0},iceServers:[],clientId:function(a){const s=[],o="0123456789";for(;a--;)s.push(o.charAt(Math.floor(Math.random()*o.length)));return s.join("")}(17)};n.connection=function(a,s,o=d,f=!1,l=!1){return new r(a,s,o,f,l)},n.defaultOptions=d,n.version=function(){return process.version},Object.defineProperty(n,"__esModule",{value:!0})})})(ue,ue.exports);const ht="wss://ayame-labo.shiguredo.app/signaling",Ve=G(),Z=G(),ze=G();async function qe(){var t;pt(),await((t=Re(Ve))==null?void 0:t.disconnect())}async function Fe(t){const e=`one-on-one-jp-${t}`,n=ue.exports.connection(ht,e),i=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});await n.connect(i),n.on("disconnect",console.log),n.on("addstream",c=>{ze.set(c.stream)}),Ve.set(n),Z.set(i)}function pt(){var t;(t=Re(Z))==null||t.getTracks().forEach(e=>e.stop())}function fe(t,e){return t.srcObject=e,{update(n){t.srcObject!==n&&(t.srcObject=n)},destroy(){}}}function _t(t){let e,n,i,c,r,d,a,s,o,f,l;return{c(){e=b("ul"),e.innerHTML=`<li>\u30AB\u30E1\u30E9\u6620\u50CF\u304C\u6B63\u3057\u304F\u8868\u793A\u3055\u308C\u3066\u3044\u307E\u3059\u304B\uFF1F</li> 
  <li>\u30DE\u30A4\u30AF\u97F3\u58F0\u304C\u30B9\u30D4\u30FC\u30AB\u30FC\u304B\u3089\u6D41\u308C\u307E\u3059\u304B\uFF1F</li> 
  <li>\u554F\u984C\u304C\u7121\u3051\u308C\u3070\u78BA\u8A8D\u306F\u5B8C\u4E86\u3067\u3059\u3002</li>`,n=$(),i=b("p"),i.textContent="\u203B\u30B9\u30D4\u30FC\u30AB\u30FC\u97F3\u304C\u30DE\u30A4\u30AF\u97F3\u58F0\u3092\u62FE\u3046\u3068\u30CF\u30A6\u30EA\u30F3\u30B0\u3057\u307E\u3059\u3002\u30B9\u30D4\u30FC\u30AB\u30FC\u97F3\u91CF\u3092\u4E0B\u3052\u3066\u3082\u3046\u4E00\u5EA6\u3054\u78BA\u8A8D\u304F\u3060\u3055\u3044\u3002",c=$(),r=b("video"),a=$(),s=b("div"),o=b("button"),o.textContent="\u9000\u5BA4\u3059\u308B",r.autoplay=!0,r.playsInline=!0},m(u,h){_(u,e,h),_(u,n,h),_(u,i,h),_(u,c,h),_(u,r,h),_(u,a,h),_(u,s,h),M(s,o),f||(l=[re(d=fe.call(null,r,t[0])),W(o,"click",t[1])],f=!0)},p(u,[h]){d&&z(d.update)&&h&1&&d.update.call(null,u[0])},i:g,o:g,d(u){u&&p(e),u&&p(n),u&&p(i),u&&p(c),u&&p(r),u&&p(a),u&&p(s),f=!1,N(l)}}}function mt(t,e,n){let i;oe(t,Z,r=>n(0,i=r)),Ie(()=>{Fe(He())});function c(){qe(),Q("/")}return[i,c]}class gt extends T{constructor(e){super(),I(this,e,mt,_t,R,{})}}function wt(t){let e,n,i;return{c(){e=b("h1"),e.textContent="One on One in \u65E5\u672C!",H(e,"class","svelte-10qdmii")},m(c,r){_(c,e,r),n||(i=W(e,"click",t[0]),n=!0)},p:g,i:g,o:g,d(c){c&&p(e),n=!1,i()}}}function yt(t){function e(n){ce.call(this,t,n)}return[e]}class ge extends T{constructor(e){super(),I(this,e,yt,wt,R,{})}}function vt(t){let e,n,i,c;return e=new ge({}),i=new gt({}),{c(){L(e.$$.fragment),n=$(),L(i.$$.fragment)},m(r,d){S(e,r,d),_(r,n,d),S(i,r,d),c=!0},p:g,i(r){c||(k(e.$$.fragment,r),k(i.$$.fragment,r),c=!0)},o(r){E(e.$$.fragment,r),E(i.$$.fragment,r),c=!1},d(r){O(e,r),r&&p(n),O(i,r)}}}class bt extends T{constructor(e){super(),I(this,e,null,vt,R,{})}}function $t(t){let e,n,i,c,r,d,a,s,o;return{c(){e=b("h2"),e.textContent="\u30EB\u30FC\u30E0",n=$(),i=b("input"),c=$(),r=b("button"),r.textContent="\u5165\u5BA4\u3059\u308B",d=$(),a=b("button"),a.textContent="\u30EB\u30FC\u30E0ID\u751F\u6210",H(i,"type","text"),H(i,"placeholder","\u30EB\u30FC\u30E0ID\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044"),H(i,"class","svelte-gzebfg")},m(f,l){_(f,e,l),_(f,n,l),_(f,i,l),Ce(i,t[0]),_(f,c,l),_(f,r,l),_(f,d,l),_(f,a,l),s||(o=[W(i,"input",t[3]),W(r,"click",t[2]),W(a,"click",t[1])],s=!0)},p(f,[l]){l&1&&i.value!==f[0]&&Ce(i,f[0])},i:g,o:g,d(f){f&&p(e),f&&p(n),f&&p(i),f&&p(c),f&&p(r),f&&p(d),f&&p(a),s=!1,N(o)}}}function Ct(t,e,n){let i="";function c(){n(0,i=He());var a="text/plain",s=new Blob([i],{type:a}),o=[new window.ClipboardItem({[a]:s})];navigator.clipboard.write(o).then(function(){},function(){})}function r(){if(i===""){alert("\u30EB\u30FC\u30E0ID\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044!");return}Q(`/room/${i}`)}function d(){i=this.value,n(0,i)}return[i,c,r,d]}class xt extends T{constructor(e){super(),I(this,e,Ct,$t,R,{})}}function kt(t){let e,n,i,c,r;return{c(){e=b("h2"),e.textContent="\u30AB\u30E1\u30E9\u30FB\u30DE\u30A4\u30AF\u30C1\u30A7\u30C3\u30AF",n=$(),i=b("button"),i.textContent="\u30AB\u30E1\u30E9\u30FB\u30DE\u30A4\u30AF\u30C1\u30A7\u30C3\u30AF"},m(d,a){_(d,e,a),_(d,n,a),_(d,i,a),c||(r=W(i,"click",t[0]),c=!0)},p:g,i:g,o:g,d(d){d&&p(e),d&&p(n),d&&p(i),c=!1,r()}}}function Et(t){return[()=>Q("/checker")]}class St extends T{constructor(e){super(),I(this,e,Et,kt,R,{})}}const Ot="0.0.5";var Lt={value:Ot};function Rt(t){let e,n,i,c,r,d,a,s;return{c(){e=b("h2"),e.textContent="\u6280\u8853\u60C5\u5831",n=$(),i=b("ul"),c=b("li"),c.innerHTML=`Signaling Server \u306B
    <a href="https://ayame-labo.shiguredo.app/" target="_blank">Ayame Labo</a>
    \u3092\u5229\u7528\u3057\u3066\u3044\u307E\u3059\u3002`,r=$(),d=b("li"),d.innerHTML=`\u300COne on One in \u65E5\u672C\u300D\u306E\u30BD\u30FC\u30B9\u30B3\u30FC\u30C9\u306F
    <a href="https://github.com/ampcpmgp/one-on-one" target="_blank">\u3053\u3061\u3089</a>`,a=$(),s=b("li"),s.textContent=`v${Lt.value}`},m(o,f){_(o,e,f),_(o,n,f),_(o,i,f),M(i,c),M(i,r),M(i,d),M(i,a),M(i,s)},p:g,i:g,o:g,d(o){o&&p(e),o&&p(n),o&&p(i)}}}class Dt extends T{constructor(e){super(),I(this,e,null,Rt,R,{})}}function It(t){let e,n,i;return{c(){e=b("h2"),e.textContent="\u4F7F\u3044\u65B9",n=$(),i=b("ul"),i.innerHTML=`<li>\u307E\u305A\u306F\u300C\u30AB\u30E1\u30E9\u30FB\u30DE\u30A4\u30AF\u30C1\u30A7\u30C3\u30AF\u300D\u304B\u3089\u3001\u81EA\u62E0\u70B9\u306E\u6620\u50CF\u3068\u97F3\u58F0\u3092\u78BA\u8A8D\u3092\u3057\u3066\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u78BA\u8A8D\u304C\u7D42\u308F\u308A\u307E\u3057\u305F\u3089\u3001\u300C\u30EB\u30FC\u30E0\u300D\u3088\u308A\u3001\u30EB\u30FC\u30E0ID\u3092\u751F\u6210\u3057\u3066\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u30EB\u30FC\u30E0ID\u751F\u6210\u5F8C\u3001\u30AF\u30EA\u30C3\u30D7\u30DC\u30FC\u30C9\u306BID\u304C\u30B3\u30D4\u30FC\u3055\u308C\u307E\u3059\u3002\u305D\u306EID\u3092\u76F8\u624B\u306B\u304A\u4F1D\u3048\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u53D7\u3051\u53D6\u3063\u305F\u65B9\u306F\u30EB\u30FC\u30E0ID\u3092\u30C6\u30AD\u30B9\u30C8\u6B04\u306B\u5165\u529B\u3057\u3001\u300C\u5165\u5BA4\u3059\u308B\u300D\u30DC\u30BF\u30F3\u3092\u62BC\u3057\u3066\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u304A\u4E92\u3044\u304C\u5165\u5BA4\u3059\u308B\u3068\u30D3\u30C7\u30AA\u901A\u8A71\u304C\u53EF\u80FD\u306B\u306A\u308A\u307E\u3059\u3002</li>`},m(c,r){_(c,e,r),_(c,n,r),_(c,i,r)},p:g,i:g,o:g,d(c){c&&p(e),c&&p(n),c&&p(i)}}}class Tt extends T{constructor(e){super(),I(this,e,null,It,R,{})}}function At(t){let e,n,i;return{c(){e=b("h2"),e.textContent="\u6982\u8981",n=$(),i=b("ul"),i.innerHTML=`<li>\u3053\u306E\u30A2\u30D7\u30EA\u306F 1:1 \u5C02\u7528\u306E\u30D3\u30C7\u30AA\u901A\u8A71\u30A2\u30D7\u30EA\u3067\u3059\u3002</li> 
  <li>\u65E5\u672C\u56FD\u5916\u304B\u3089\u306F\u3054\u5229\u7528\u3067\u304D\u307E\u305B\u3093\u3002</li> 
  <li>\u540C\u50DA\u3084\u53CB\u4EBA\u3068\u304A\u4F7F\u3044\u304F\u3060\u3055\u3044\u3002\u4E0D\u7279\u5B9A\u591A\u6570\u3068\u7E4B\u304C\u308B\u3053\u3068\u306F\u3067\u304D\u307E\u305B\u3093\u3002</li>`},m(c,r){_(c,e,r),_(c,n,r),_(c,i,r)},p:g,i:g,o:g,d(c){c&&p(e),c&&p(n),c&&p(i)}}}class Pt extends T{constructor(e){super(),I(this,e,null,At,R,{})}}function jt(t){let e,n,i,c,r,d,a,s,o,f;return e=new Pt({}),i=new Tt({}),r=new St({}),a=new xt({}),o=new Dt({}),{c(){L(e.$$.fragment),n=$(),L(i.$$.fragment),c=$(),L(r.$$.fragment),d=$(),L(a.$$.fragment),s=$(),L(o.$$.fragment)},m(l,u){S(e,l,u),_(l,n,u),S(i,l,u),_(l,c,u),S(r,l,u),_(l,d,u),S(a,l,u),_(l,s,u),S(o,l,u),f=!0},p:g,i(l){f||(k(e.$$.fragment,l),k(i.$$.fragment,l),k(r.$$.fragment,l),k(a.$$.fragment,l),k(o.$$.fragment,l),f=!0)},o(l){E(e.$$.fragment,l),E(i.$$.fragment,l),E(r.$$.fragment,l),E(a.$$.fragment,l),E(o.$$.fragment,l),f=!1},d(l){O(e,l),l&&p(n),O(i,l),l&&p(c),O(r,l),l&&p(d),O(a,l),l&&p(s),O(o,l)}}}class Mt extends T{constructor(e){super(),I(this,e,null,jt,R,{})}}function Nt(t){let e,n,i,c;return e=new ge({}),i=new Mt({}),{c(){L(e.$$.fragment),n=$(),L(i.$$.fragment)},m(r,d){S(e,r,d),_(r,n,d),S(i,r,d),c=!0},p:g,i(r){c||(k(e.$$.fragment,r),k(i.$$.fragment,r),c=!0)},o(r){E(e.$$.fragment,r),E(i.$$.fragment,r),c=!1},d(r){O(e,r),r&&p(n),O(i,r)}}}class Ut extends T{constructor(e){super(),I(this,e,null,Nt,R,{})}}function Wt(t){let e;return{c(){e=b("p"),e.textContent="404"},m(n,i){_(n,e,i)},p:g,i:g,o:g,d(n){n&&p(e)}}}class Ht extends T{constructor(e){super(),I(this,e,null,Wt,R,{})}}function Vt(t){let e,n,i,c,r,d,a,s,o,f,l,u,h;return{c(){e=b("p"),e.textContent="\u203B\u76F8\u624B\u5074\u306E\u753B\u9762\u304C\u9ED2\u304F\u306A\u3063\u305F\u5834\u5408\u306F\u5207\u65AD\u3055\u308C\u3066\u3044\u307E\u3059\u3002\u518D\u5EA6\u901A\u8A71\u3092\u3057\u305F\u3044\u5834\u5408\u3001\u30EA\u30ED\u30FC\u30C9\u3059\u308B\u304B\u3001\u518D\u5EA6\u30EB\u30FC\u30E0ID\u3092\u518D\u751F\u6210\u3057\u3066\u304F\u3060\u3055\u3044\u3002",n=$(),i=b("div"),c=b("video"),d=$(),a=b("video"),o=$(),f=b("div"),l=b("button"),l.textContent="\u9000\u5BA4\u3059\u308B",c.muted=!0,c.autoplay=!0,c.playsInline=!0,H(c,"class","svelte-1eo6cx9"),a.autoplay=!0,a.playsInline=!0,H(a,"class","svelte-1eo6cx9"),H(i,"class","videos svelte-1eo6cx9")},m(m,C){_(m,e,C),_(m,n,C),_(m,i,C),M(i,c),M(i,d),M(i,a),_(m,o,C),_(m,f,C),M(f,l),u||(h=[re(r=fe.call(null,c,t[0])),re(s=fe.call(null,a,t[1])),W(l,"click",t[2])],u=!0)},p(m,[C]){r&&z(r.update)&&C&1&&r.update.call(null,m[0]),s&&z(s.update)&&C&2&&s.update.call(null,m[1])},i:g,o:g,d(m){m&&p(e),m&&p(n),m&&p(i),m&&p(o),m&&p(f),u=!1,N(h)}}}function zt(t,e,n){let i,c;oe(t,Z,a=>n(0,i=a)),oe(t,ze,a=>n(1,c=a));let{params:r={}}=e;Ie(()=>{Fe(r.id)});function d(){qe(),Q("/")}return t.$$set=a=>{"params"in a&&n(3,r=a.params)},[i,c,d,r]}class qt extends T{constructor(e){super(),I(this,e,zt,Vt,R,{params:3})}}function Ft(t){let e,n,i,c;return e=new ge({}),i=new qt({}),{c(){L(e.$$.fragment),n=$(),L(i.$$.fragment)},m(r,d){S(e,r,d),_(r,n,d),S(i,r,d),c=!0},p:g,i(r){c||(k(e.$$.fragment,r),k(i.$$.fragment,r),c=!0)},o(r){E(e.$$.fragment,r),E(i.$$.fragment,r),c=!1},d(r){O(e,r),r&&p(n),O(i,r)}}}class Yt extends T{constructor(e){super(),I(this,e,null,Ft,R,{})}}var Gt={"/":Ut,"/checker":bt,"/room/:id":Yt,"*":Ht};function Jt(t){let e,n;return e=new ft({props:{routes:Gt}}),{c(){L(e.$$.fragment)},m(i,c){S(e,i,c),n=!0},p:g,i(i){n||(k(e.$$.fragment,i),n=!0)},o(i){E(e.$$.fragment,i),n=!1},d(i){O(e,i)}}}class Xt extends T{constructor(e){super(),I(this,e,null,Jt,R,{})}}new Xt({target:document.body});
