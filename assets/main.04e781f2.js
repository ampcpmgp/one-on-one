var Ge=Object.defineProperty,Je=Object.defineProperties;var Xe=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable;var ye=(t,e,s)=>e in t?Ge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ve=(t,e)=>{for(var s in e||(e={}))Be.call(e,s)&&ye(t,s,e[s]);if(we)for(var s of we(e))Ke.call(e,s)&&ye(t,s,e[s]);return t},be=(t,e)=>Je(t,Xe(e));function m(){}function Oe(t,e){for(const s in e)t[s]=e[s];return t}function Le(t){return t()}function $e(){return Object.create(null)}function N(t){t.forEach(Le)}function z(t){return typeof t=="function"}function L(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Qe(t){return Object.keys(t).length===0}function de(t,...e){if(t==null)return m;const s=t.subscribe(...e);return s.unsubscribe?()=>s.unsubscribe():s}function Re(t){let e;return de(t,s=>e=s)(),e}function oe(t,e,s){t.$$.on_destroy.push(de(e,s))}function re(t){return t&&z(t.destroy)?t.destroy:m}function M(t,e){t.appendChild(e)}function p(t,e,s){t.insertBefore(e,s||null)}function _(t){t.parentNode.removeChild(t)}function b(t){return document.createElement(t)}function De(t){return document.createTextNode(t)}function $(){return De(" ")}function he(){return De("")}function W(t,e,s,i){return t.addEventListener(e,s,i),()=>t.removeEventListener(e,s,i)}function H(t,e,s){s==null?t.removeAttribute(e):t.getAttribute(e)!==s&&t.setAttribute(e,s)}function Ze(t){return Array.from(t.childNodes)}function Ce(t,e){t.value=e==null?"":e}function et(t,e,{bubbles:s=!1,cancelable:i=!1}={}){const c=document.createEvent("CustomEvent");return c.initCustomEvent(t,s,i,e),c}let Y;function F(t){Y=t}function K(){if(!Y)throw new Error("Function called outside component initialization");return Y}function Ie(t){K().$$.on_mount.push(t)}function tt(t){K().$$.after_update.push(t)}function nt(t){K().$$.on_destroy.push(t)}function st(){const t=K();return(e,s,{cancelable:i=!1}={})=>{const c=t.$$.callbacks[e];if(c){const r=et(e,s,{cancelable:i});return c.slice().forEach(d=>{d.call(t,r)}),!r.defaultPrevented}return!0}}function ce(t,e){const s=t.$$.callbacks[e.type];s&&s.slice().forEach(i=>i.call(this,e))}const q=[],xe=[],X=[],ke=[],Te=Promise.resolve();let ae=!1;function Ae(){ae||(ae=!0,Te.then(je))}function Pe(){return Ae(),Te}function le(t){X.push(t)}const ie=new Set;let J=0;function je(){const t=Y;do{for(;J<q.length;){const e=q[J];J++,F(e),it(e.$$)}for(F(null),q.length=0,J=0;xe.length;)xe.pop()();for(let e=0;e<X.length;e+=1){const s=X[e];ie.has(s)||(ie.add(s),s())}X.length=0}while(q.length);for(;ke.length;)ke.pop()();ae=!1,ie.clear(),F(t)}function it(t){if(t.fragment!==null){t.update(),N(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(le)}}const B=new Set;let U;function _e(){U={r:0,c:[],p:U}}function pe(){U.r||N(U.c),U=U.p}function x(t,e){t&&t.i&&(B.delete(t),t.i(e))}function k(t,e,s,i){if(t&&t.o){if(B.has(t))return;B.add(t),U.c.push(()=>{B.delete(t),i&&(s&&t.d(1),i())}),t.o(e)}}function Me(t,e){const s={},i={},c={$$scope:1};let r=t.length;for(;r--;){const d=t[r],a=e[r];if(a){for(const n in d)n in a||(i[n]=1);for(const n in a)c[n]||(s[n]=a[n],c[n]=1);t[r]=a}else for(const n in d)c[n]=1}for(const d in i)d in s||(s[d]=void 0);return s}function Ne(t){return typeof t=="object"&&t!==null?t:{}}function O(t){t&&t.c()}function E(t,e,s,i){const{fragment:c,on_mount:r,on_destroy:d,after_update:a}=t.$$;c&&c.m(e,s),i||le(()=>{const n=r.map(Le).filter(z);d?d.push(...n):N(n),t.$$.on_mount=[]}),a.forEach(le)}function S(t,e){const s=t.$$;s.fragment!==null&&(N(s.on_destroy),s.fragment&&s.fragment.d(e),s.on_destroy=s.fragment=null,s.ctx=[])}function ot(t,e){t.$$.dirty[0]===-1&&(q.push(t),Ae(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function D(t,e,s,i,c,r,d,a=[-1]){const n=Y;F(t);const o=t.$$={fragment:null,ctx:null,props:r,update:m,not_equal:c,bound:$e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(n?n.$$.context:[])),callbacks:$e(),dirty:a,skip_bound:!1,root:e.target||n.$$.root};d&&d(o.root);let u=!1;if(o.ctx=s?s(t,e.props||{},(l,f,...h)=>{const v=h.length?h[0]:f;return o.ctx&&c(o.ctx[l],o.ctx[l]=v)&&(!o.skip_bound&&o.bound[l]&&o.bound[l](v),u&&ot(t,l)),f}):[],o.update(),u=!0,N(o.before_update),o.fragment=i?i(o.ctx):!1,e.target){if(e.hydrate){const l=Ze(e.target);o.fragment&&o.fragment.l(l),l.forEach(_)}else o.fragment&&o.fragment.c();e.intro&&x(t.$$.fragment),E(t,e.target,e.anchor,e.customElement),je()}F(n)}class I{$destroy(){S(this,1),this.$destroy=m}$on(e,s){const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(s),()=>{const c=i.indexOf(s);c!==-1&&i.splice(c,1)}}$set(e){this.$$set&&!Qe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const V=[];function Ue(t,e){return{subscribe:G(t,e).subscribe}}function G(t,e=m){let s;const i=new Set;function c(a){if(L(t,a)&&(t=a,s)){const n=!V.length;for(const o of i)o[1](),V.push(o,t);if(n){for(let o=0;o<V.length;o+=2)V[o][0](V[o+1]);V.length=0}}}function r(a){c(a(t))}function d(a,n=m){const o=[a,n];return i.add(o),i.size===1&&(s=e(c)||m),a(t),()=>{i.delete(o),i.size===0&&(s(),s=null)}}return{set:c,update:r,subscribe:d}}function We(t,e,s){const i=!Array.isArray(t),c=i?[t]:t,r=e.length<2;return Ue(s,d=>{let a=!1;const n=[];let o=0,u=m;const l=()=>{if(o)return;u();const h=e(i?n[0]:n,d);r?d(h):u=z(h)?h:m},f=c.map((h,v)=>de(h,P=>{n[v]=P,o&=~(1<<v),a&&l()},()=>{o|=1<<v}));return a=!0,l(),function(){N(f),u()}})}function rt(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var s,i,c,r,d=[],a="",n=t.split("/");for(n[0]||n.shift();c=n.shift();)s=c[0],s==="*"?(d.push("wild"),a+="/(.*)"):s===":"?(i=c.indexOf("?",1),r=c.indexOf(".",1),d.push(c.substring(1,~i?i:~r?r:c.length)),a+=!!~i&&!~r?"(?:/([^/]+?))?":"/([^/]+?)",~r&&(a+=(~i?"?":"")+"\\"+c.substring(r))):a+="/"+c;return{keys:d,pattern:new RegExp("^"+a+(e?"(?=$|/)":"/?$"),"i")}}function ct(t){let e,s,i;const c=[t[2]];var r=t[0];function d(a){let n={};for(let o=0;o<c.length;o+=1)n=Oe(n,c[o]);return{props:n}}return r&&(e=new r(d()),e.$on("routeEvent",t[7])),{c(){e&&O(e.$$.fragment),s=he()},m(a,n){e&&E(e,a,n),p(a,s,n),i=!0},p(a,n){const o=n&4?Me(c,[Ne(a[2])]):{};if(r!==(r=a[0])){if(e){_e();const u=e;k(u.$$.fragment,1,0,()=>{S(u,1)}),pe()}r?(e=new r(d()),e.$on("routeEvent",a[7]),O(e.$$.fragment),x(e.$$.fragment,1),E(e,s.parentNode,s)):e=null}else r&&e.$set(o)},i(a){i||(e&&x(e.$$.fragment,a),i=!0)},o(a){e&&k(e.$$.fragment,a),i=!1},d(a){a&&_(s),e&&S(e,a)}}}function at(t){let e,s,i;const c=[{params:t[1]},t[2]];var r=t[0];function d(a){let n={};for(let o=0;o<c.length;o+=1)n=Oe(n,c[o]);return{props:n}}return r&&(e=new r(d()),e.$on("routeEvent",t[6])),{c(){e&&O(e.$$.fragment),s=he()},m(a,n){e&&E(e,a,n),p(a,s,n),i=!0},p(a,n){const o=n&6?Me(c,[n&2&&{params:a[1]},n&4&&Ne(a[2])]):{};if(r!==(r=a[0])){if(e){_e();const u=e;k(u.$$.fragment,1,0,()=>{S(u,1)}),pe()}r?(e=new r(d()),e.$on("routeEvent",a[6]),O(e.$$.fragment),x(e.$$.fragment,1),E(e,s.parentNode,s)):e=null}else r&&e.$set(o)},i(a){i||(e&&x(e.$$.fragment,a),i=!0)},o(a){e&&k(e.$$.fragment,a),i=!1},d(a){a&&_(s),e&&S(e,a)}}}function lt(t){let e,s,i,c;const r=[at,ct],d=[];function a(n,o){return n[1]?0:1}return e=a(t),s=d[e]=r[e](t),{c(){s.c(),i=he()},m(n,o){d[e].m(n,o),p(n,i,o),c=!0},p(n,[o]){let u=e;e=a(n),e===u?d[e].p(n,o):(_e(),k(d[u],1,1,()=>{d[u]=null}),pe(),s=d[e],s?s.p(n,o):(s=d[e]=r[e](n),s.c()),x(s,1),s.m(i.parentNode,i))},i(n){c||(x(s),c=!0)},o(n){k(s),c=!1},d(n){d[e].d(n),n&&_(i)}}}function Ee(){const t=window.location.href.indexOf("#/");let e=t>-1?window.location.href.substr(t+1):"/";const s=e.indexOf("?");let i="";return s>-1&&(i=e.substr(s+1),e=e.substr(0,s)),{location:e,querystring:i}}const me=Ue(null,function(e){e(Ee());const s=()=>{e(Ee())};return window.addEventListener("hashchange",s,!1),function(){window.removeEventListener("hashchange",s,!1)}});We(me,t=>t.location);We(me,t=>t.querystring);const Se=G(void 0);async function Q(t){if(!t||t.length<1||t.charAt(0)!="/"&&t.indexOf("#/")!==0)throw Error("Invalid parameter location");await Pe(),history.replaceState(be(ve({},history.state),{__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY}),void 0,void 0),window.location.hash=(t.charAt(0)=="#"?"":"#")+t}function ut(t,e,s){let{routes:i={}}=e,{prefix:c=""}=e,{restoreScrollState:r=!1}=e;class d{constructor(g,w){if(!w||typeof w!="function"&&(typeof w!="object"||w._sveltesparouter!==!0))throw Error("Invalid component object");if(!g||typeof g=="string"&&(g.length<1||g.charAt(0)!="/"&&g.charAt(0)!="*")||typeof g=="object"&&!(g instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:T,keys:C}=rt(g);this.path=g,typeof w=="object"&&w._sveltesparouter===!0?(this.component=w.component,this.conditions=w.conditions||[],this.userData=w.userData,this.props=w.props||{}):(this.component=()=>Promise.resolve(w),this.conditions=[],this.props={}),this._pattern=T,this._keys=C}match(g){if(c){if(typeof c=="string")if(g.startsWith(c))g=g.substr(c.length)||"/";else return null;else if(c instanceof RegExp){const A=g.match(c);if(A&&A[0])g=g.substr(A[0].length)||"/";else return null}}const w=this._pattern.exec(g);if(w===null)return null;if(this._keys===!1)return w;const T={};let C=0;for(;C<this._keys.length;){try{T[this._keys[C]]=decodeURIComponent(w[C+1]||"")||null}catch{T[this._keys[C]]=null}C++}return T}async checkConditions(g){for(let w=0;w<this.conditions.length;w++)if(!await this.conditions[w](g))return!1;return!0}}const a=[];i instanceof Map?i.forEach((y,g)=>{a.push(new d(g,y))}):Object.keys(i).forEach(y=>{a.push(new d(y,i[y]))});let n=null,o=null,u={};const l=st();async function f(y,g){await Pe(),l(y,g)}let h=null,v=null;r&&(v=y=>{y.state&&y.state.__svelte_spa_router_scrollY?h=y.state:h=null},window.addEventListener("popstate",v),tt(()=>{h?window.scrollTo(h.__svelte_spa_router_scrollX,h.__svelte_spa_router_scrollY):window.scrollTo(0,0)}));let P=null,j=null;const R=me.subscribe(async y=>{P=y;let g=0;for(;g<a.length;){const w=a[g].match(y.location);if(!w){g++;continue}const T={route:a[g].path,location:y.location,querystring:y.querystring,userData:a[g].userData,params:w&&typeof w=="object"&&Object.keys(w).length?w:null};if(!await a[g].checkConditions(T)){s(0,n=null),j=null,f("conditionsFailed",T);return}f("routeLoading",Object.assign({},T));const C=a[g].component;if(j!=C){C.loading?(s(0,n=C.loading),j=C,s(1,o=C.loadingParams),s(2,u={}),f("routeLoaded",Object.assign({},T,{component:n,name:n.name,params:o}))):(s(0,n=null),j=null);const A=await C();if(y!=P)return;s(0,n=A&&A.default||A),j=C}w&&typeof w=="object"&&Object.keys(w).length?s(1,o=w):s(1,o=null),s(2,u=a[g].props),f("routeLoaded",Object.assign({},T,{component:n,name:n.name,params:o})).then(()=>{Se.set(o)});return}s(0,n=null),j=null,Se.set(void 0)});nt(()=>{R(),v&&window.removeEventListener("popstate",v)});function ee(y){ce.call(this,t,y)}function te(y){ce.call(this,t,y)}return t.$$set=y=>{"routes"in y&&s(3,i=y.routes),"prefix"in y&&s(4,c=y.prefix),"restoreScrollState"in y&&s(5,r=y.restoreScrollState)},t.$$.update=()=>{t.$$.dirty&32&&(history.scrollRestoration=r?"manual":"auto")},[n,o,u,i,c,r,ee,te]}class ft extends I{constructor(e){super(),D(this,e,ut,lt,L,{routes:3,prefix:4,restoreScrollState:5})}}let He=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,s)=>(s&=63,s<36?e+=s.toString(36):s<62?e+=(s-26).toString(36).toUpperCase():s>62?e+="-":e+="_",e),"");var dt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ue={exports:{}};(function(t,e){(function(s,i){i(e)})(dt,function(s){function i(){const a=window.navigator.userAgent.toLocaleLowerCase();return a.indexOf("edge")!==-1?"edge":a.indexOf("chrome")!==-1&&a.indexOf("edge")===-1?"chrome":a.indexOf("safari")!==-1&&a.indexOf("chrome")===-1?"safari":a.indexOf("opera")!==-1?"opera":a.indexOf("firefox")!==-1?"firefox":"unknown"}function c(a,n){let o="";o=a==="VP8"?"video/VP8":a==="VP9"?"video/VP9":a==="H264"?"video/H264":`video/${a}`;const u=n.filter(l=>l.mimeType==o);if(u.length<1)throw new Error("invalid video codec type");return u}class r extends class{constructor(n,o,u,l=!1,f=!1){this.debug=l,this.roomId=o,this.signalingUrl=n,this.options=u,this._removeCodec=!1,this.stream=null,this.remoteStream=null,this._pc=null,this._ws=null,this.authnMetadata=null,this.authzMetadata=null,this._dataChannels=[],this._isOffer=!1,this._isExistUser=!1,this.connectionState="new",this._pcConfig={iceServers:this.options.iceServers,iceTransportPolicy:f?"relay":"all"},this._callbacks={open:()=>{},connect:()=>{},disconnect:()=>{},addstream:()=>{},removestream:()=>{},bye:()=>{},datachannel:()=>{}}}on(n,o){n in this._callbacks&&(this._callbacks[n]=o)}async _disconnect(){await this._dataChannels.forEach(async n=>{await this._closeDataChannel(n)}),await this._closePeerConnection(),await this._closeWebSocketConnection(),this.authzMetadata=null,this._removeCodec=!1,this._isOffer=!1,this._isExistUser=!1,this._dataChannels=[],this.connectionState="new"}async _signaling(){return new Promise((n,o)=>{if(this._ws)return o("WS-ALREADY-EXISTS");this._ws=new WebSocket(this.signalingUrl),this._ws.onclose=async()=>(await this._disconnect(),this._callbacks.disconnect({reason:"WS-CLOSED"}),o("WS-CLOSED")),this._ws.onerror=async()=>(await this._disconnect(),o("WS-CLOSED-WITH-ERROR")),this._ws.onopen=()=>{const u={type:"register",roomId:this.roomId,clientId:this.options.clientId,authnMetadata:void 0,key:void 0};this.authnMetadata!==null&&(u.authnMetadata=this.authnMetadata),this.options.signalingKey!==null&&(u.key=this.options.signalingKey),this._sendWs(u),this._ws&&(this._ws.onmessage=async l=>{try{if(typeof l.data!="string")return;const f=JSON.parse(l.data);if(f.type==="ping")this._sendWs({type:"pong"});else{if(f.type==="bye")return this._callbacks.bye(l),n();if(f.type==="accept")return this.authzMetadata=f.authzMetadata,Array.isArray(f.iceServers)&&f.iceServers.length>0&&(this._traceLog("iceServers=>",f.iceServers),this._pcConfig.iceServers=f.iceServers),this._traceLog("isExistUser=>",f.isExistUser),this._isExistUser=f.isExistUser,this._createPeerConnection(),this._isExistUser===!0&&await this._sendOffer(),n();if(f.type==="reject")return await this._disconnect(),this._callbacks.disconnect({reason:f.reason||"REJECTED"}),o("REJECTED");if(f.type==="offer")this._pc&&this._pc.signalingState==="have-local-offer"&&this._createPeerConnection(),this._setOffer(new RTCSessionDescription(f));else if(f.type==="answer")await this._setAnswer(new RTCSessionDescription(f));else if(f.type==="candidate"&&f.ice){this._traceLog("Received ICE candidate ...",f.ice);const h=new RTCIceCandidate(f.ice);this._addIceCandidate(h)}}}catch(f){await this._disconnect(),this._callbacks.disconnect({reason:"SIGNALING-ERROR",error:f})}})}})}_createPeerConnection(){this._traceLog("RTCConfiguration=>",this._pcConfig);const n=new RTCPeerConnection(this._pcConfig),o=this.stream&&this.stream.getAudioTracks()[0];o&&this.options.audio.direction!=="recvonly"?n.addTrack(o,this.stream):this.options.audio.enabled&&n.addTransceiver("audio",{direction:"recvonly"});const u=this.stream&&this.stream.getVideoTracks()[0];if(u&&this.options.video.direction!=="recvonly"){const f=n.addTrack(u,this.stream),h=this._getTransceiver(n,f);if(this._isVideoCodecSpecified()&&h!==null)if(h.setCodecPreferences!==void 0){const v=RTCRtpSender.getCapabilities("video");if(v){let P=[];this.options.video.codec&&(P=c(this.options.video.codec,v.codecs)),this._traceLog("video codecs=",P),h.setCodecPreferences(P)}}else this._removeCodec=!0}else if(this.options.video.enabled){const f=n.addTransceiver("video",{direction:"recvonly"});if(this._isVideoCodecSpecified())if(f.setCodecPreferences!==void 0){const h=RTCRtpSender.getCapabilities("video");if(h){let v=[];this.options.video.codec&&(v=c(this.options.video.codec,h.codecs)),this._traceLog("video codecs=",v),f.setCodecPreferences(v)}}else this._removeCodec=!0}const l=[];n.ontrack=f=>{const h=f;if(this._traceLog("peer.ontrack()",f),i()==="safari"){l.push(f.track);const v=new MediaStream(l);this.remoteStream=v}else this.remoteStream=f.streams[0];h.stream=this.remoteStream,this._callbacks.addstream(h)},n.onicecandidate=f=>{this._traceLog("peer.onicecandidate()",f),f.candidate?this._sendIceCandidate(f.candidate):this._traceLog("empty ice event","")},n.oniceconnectionstatechange=async()=>{if(this._traceLog("ICE connection Status has changed to ",n.iceConnectionState),this.connectionState!==n.iceConnectionState)switch(this.connectionState=n.iceConnectionState,this.connectionState){case"connected":this._isOffer=!1,this._callbacks.connect();break;case"disconnected":case"failed":await this._disconnect(),this._callbacks.disconnect({reason:"ICE-CONNECTION-STATE-FAILED"})}},n.onsignalingstatechange=f=>{this._traceLog("signaling state changes:",n.signalingState)},n.ondatachannel=this._onDataChannel.bind(this),this._pc?this._pc=n:(this._pc=n,this._callbacks.open({authzMetadata:this.authzMetadata}))}async _createDataChannel(n,o){return new Promise((u,l)=>{if(!this._pc)return l("PeerConnection Does Not Ready");if(this._isOffer)return l("PeerConnection Has Local Offer");let f=this._findDataChannel(n);return f?l("DataChannel Already Exists!"):this._isExistUser?(f=this._pc.createDataChannel(n,o),f.onclose=h=>{this._traceLog("datachannel onclosed=>",h),this._dataChannels=this._dataChannels.filter(v=>v.label!=n)},f.onerror=h=>{this._traceLog("datachannel onerror=>",h),this._dataChannels=this._dataChannels.filter(v=>v.label!=n)},f.onmessage=h=>{this._traceLog("datachannel onmessage=>",h.data),h.label=n},f.onopen=h=>{this._traceLog("datachannel onopen=>",h)},this._dataChannels.push(f),u(f)):u(null)})}_onDataChannel(n){if(this._traceLog("on data channel",n),!this._pc)return;const o=n.channel,u=n.channel.label;n.channel&&(!u||u.length<1||(o.onopen=async l=>{this._traceLog("datachannel onopen=>",l)},o.onclose=async l=>{this._traceLog("datachannel onclosed=>",l)},o.onerror=async l=>{this._traceLog("datachannel onerror=>",l)},o.onmessage=l=>{this._traceLog("datachannel onmessage=>",l.data),l.label=u},this._findDataChannel(u)?this._dataChannels=this._dataChannels.map(l=>l.label==u?o:l):this._dataChannels.push(n.channel),this._callbacks.datachannel(o)))}async _sendOffer(){if(!this._pc)return;i()==="safari"&&(this.options.video.enabled&&this.options.video.direction==="sendrecv"&&this._pc.addTransceiver("video",{direction:"recvonly"}),this.options.audio.enabled&&this.options.audio.direction==="sendrecv"&&this._pc.addTransceiver("audio",{direction:"recvonly"}));const n=await this._pc.createOffer({offerToReceiveAudio:this.options.audio.enabled&&this.options.audio.direction!=="sendonly",offerToReceiveVideo:this.options.video.enabled&&this.options.video.direction!=="sendonly"});this._removeCodec&&this.options.video.codec&&["VP8","VP9","H264"].forEach(o=>{this.options.video.codec!==o&&(n.sdp=function(u,l){return function f(h){const v=new RegExp("(a=rtpmap:(\\d*) "+l+"/90000\\r\\n)"),P=h.match(v);if(P==null||P.length<=2)return u;const j=P[2];let R=h.replace(v,"");const ee=new RegExp("(a=rtcp-fb:"+j+`.*\r
)`,"g");R=R.replace(ee,"");const te=new RegExp("(a=fmtp:"+j+`.*\r
)`,"g");R=R.replace(te,"");const y=new RegExp("(a=fmtp:(\\d*) apt="+j+"\\r\\n)"),g=R.match(y);let w="";if(g!=null&&g.length>=3){w=g[2],R=R.replace(y,"");const A=new RegExp("(a=rtpmap:"+w+`.*\r
)`,"g");R=R.replace(A,"")}const T=/(m=video.*\r\n)/,C=R.match(T);if(C!=null){const A=C[0].substring(0,C[0].length-2).split(" ");let ne=A[0];A.forEach((se,Ye)=>{Ye!==0&&se!=j&&se!=w&&(ne+=" "+se)}),ne+=`\r
`,R=R.replace(T,ne)}return f(R)}(u)}(n.sdp,o))}),this._traceLog("create offer sdp, sdp=",n.sdp),await this._pc.setLocalDescription(n),this._pc.localDescription&&this._sendSdp(this._pc.localDescription),this._isOffer=!0}_isVideoCodecSpecified(){return this.options.video.enabled&&this.options.video.codec!==null}async _createAnswer(){if(this._pc)try{const n=await this._pc.createAnswer();this._traceLog("create answer sdp, sdp=",n.sdp),await this._pc.setLocalDescription(n),this._pc.localDescription&&this._sendSdp(this._pc.localDescription)}catch(n){await this._disconnect(),this._callbacks.disconnect({reason:"CREATE-ANSWER-ERROR",error:n})}}async _setAnswer(n){this._pc&&(await this._pc.setRemoteDescription(n),this._traceLog("set answer sdp=",n.sdp))}async _setOffer(n){try{if(!this._pc)return;await this._pc.setRemoteDescription(n),this._traceLog("set offer sdp=",n.sdp),await this._createAnswer()}catch(o){await this._disconnect(),this._callbacks.disconnect({reason:"SET-OFFER-ERROR",error:o})}}async _addIceCandidate(n){try{this._pc&&await this._pc.addIceCandidate(n)}catch{this._traceLog("invalid ice candidate",n)}}_sendIceCandidate(n){const o={type:"candidate",ice:n};this._sendWs(o)}_sendSdp(n){this._sendWs(n)}_sendWs(n){this._ws&&this._ws.send(JSON.stringify(n))}_getTransceiver(n,o){let u=null;if(n.getTransceivers().forEach(l=>{l.sender!=o&&l.receiver!=o||(u=l)}),!u)throw new Error("invalid transceiver");return u}_findDataChannel(n){return this._dataChannels.find(o=>o.label==n)}async _closeDataChannel(n){return new Promise(o=>{if(n.readyState==="closed")return o();n.onclose=null;const u=setInterval(()=>{if(n.readyState==="closed")return clearInterval(u),o()},400);n&&n.close()})}async _closePeerConnection(){return new Promise(n=>{if(i()==="safari"&&this._pc)return this._pc.oniceconnectionstatechange=()=>{},this._pc.close(),this._pc=null,n();if(!this._pc)return n();if(this._pc&&this._pc.signalingState=="closed")return this._pc=null,n();this._pc.oniceconnectionstatechange=()=>{};const o=setInterval(()=>this._pc?this._pc&&this._pc.signalingState=="closed"?(this._pc=null,clearInterval(o),n()):void 0:(clearInterval(o),n()),400);this._pc.close()})}async _closeWebSocketConnection(){return new Promise(n=>{if(!this._ws)return n();if(this._ws&&this._ws.readyState===3)return this._ws=null,n();this._ws.onclose=()=>{};const o=setInterval(()=>this._ws?this._ws.readyState===3?(this._ws=null,clearInterval(o),n()):void 0:(clearInterval(o),n()),400);this._ws&&this._ws.close()})}_traceLog(n,o){this.debug&&function(u,l){let f="";window.performance&&(f="[Ayame "+(window.performance.now()/1e3).toFixed(3)+"]"),i()==="edge"?console.log(f+" "+u+`
`,l):console.info(f+" "+u+`
`,l)}(n,o)}}{constructor(n,o,u,l=!1,f=!1){super(n,o,u,l,f)}async connect(n,o=null){if(this._ws||this._pc)throw this._traceLog("connection already exists"),new Error("Connection Already Exists!");this.stream=n,o&&(this.authnMetadata=o.authnMetadata),await this._signaling()}async createDataChannel(n,o){return await this._createDataChannel(n,o)}async removeDataChannel(n){this._traceLog("datachannel remove=>",n);const o=this._findDataChannel(n);if(!o||o.readyState!=="open")throw new Error("data channel is not exist or open");await this._closeDataChannel(o)}async disconnect(){return new Promise(n=>(this._ws&&this._ws.close(),n()))}}const d={audio:{direction:"sendrecv",enabled:!0},video:{direction:"sendrecv",enabled:!0},iceServers:[],clientId:function(a){const n=[],o="0123456789";for(;a--;)n.push(o.charAt(Math.floor(Math.random()*o.length)));return n.join("")}(17)};s.connection=function(a,n,o=d,u=!1,l=!1){return new r(a,n,o,u,l)},s.defaultOptions=d,s.version=function(){return process.version},Object.defineProperty(s,"__esModule",{value:!0})})})(ue,ue.exports);const ht="wss://ayame-labo.shiguredo.app/signaling",Ve=G(),Z=G(),ze=G();async function qe(){var t;_t(),await((t=Re(Ve))==null?void 0:t.disconnect())}async function Fe(t){const e=`one-on-one-jp-${t}`,s=ue.exports.connection(ht,e),i=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});await s.connect(i),s.on("disconnect",console.log),s.on("addstream",c=>{ze.set(c.stream)}),Ve.set(s),Z.set(i)}function _t(){var t;(t=Re(Z))==null||t.getTracks().forEach(e=>e.stop())}function fe(t,e){return t.srcObject=e,{update(s){t.srcObject!==s&&(t.srcObject=s)},destroy(){}}}function pt(t){let e,s,i,c,r,d,a,n,o;return{c(){e=b("ul"),e.innerHTML=`<li>\u30AB\u30E1\u30E9\u6620\u50CF\u304C\u6B63\u3057\u304F\u8868\u793A\u3055\u308C\u3066\u3044\u307E\u3059\u304B\uFF1F</li> 
  <li>\u30DE\u30A4\u30AF\u97F3\u58F0\u304C\u30B9\u30D4\u30FC\u30AB\u30FC\u304B\u3089\u6D41\u308C\u307E\u3059\u304B\uFF1F</li> 
  <li>\u554F\u984C\u304C\u7121\u3051\u308C\u3070\u78BA\u8A8D\u306F\u5B8C\u4E86\u3067\u3059\u3002</li>`,s=$(),i=b("video"),r=$(),d=b("div"),a=b("button"),a.textContent="\u9000\u5BA4\u3059\u308B",i.autoplay=!0,i.playsInline=!0},m(u,l){p(u,e,l),p(u,s,l),p(u,i,l),p(u,r,l),p(u,d,l),M(d,a),n||(o=[re(c=fe.call(null,i,t[0])),W(a,"click",t[1])],n=!0)},p(u,[l]){c&&z(c.update)&&l&1&&c.update.call(null,u[0])},i:m,o:m,d(u){u&&_(e),u&&_(s),u&&_(i),u&&_(r),u&&_(d),n=!1,N(o)}}}function mt(t,e,s){let i;oe(t,Z,r=>s(0,i=r)),Ie(()=>{Fe(He())});function c(){qe(),Q("/")}return[i,c]}class gt extends I{constructor(e){super(),D(this,e,mt,pt,L,{})}}function wt(t){let e,s,i;return{c(){e=b("h1"),e.textContent="One on One in \u65E5\u672C!",H(e,"class","svelte-10qdmii")},m(c,r){p(c,e,r),s||(i=W(e,"click",t[0]),s=!0)},p:m,i:m,o:m,d(c){c&&_(e),s=!1,i()}}}function yt(t){function e(s){ce.call(this,t,s)}return[e]}class ge extends I{constructor(e){super(),D(this,e,yt,wt,L,{})}}function vt(t){let e,s,i,c;return e=new ge({}),i=new gt({}),{c(){O(e.$$.fragment),s=$(),O(i.$$.fragment)},m(r,d){E(e,r,d),p(r,s,d),E(i,r,d),c=!0},p:m,i(r){c||(x(e.$$.fragment,r),x(i.$$.fragment,r),c=!0)},o(r){k(e.$$.fragment,r),k(i.$$.fragment,r),c=!1},d(r){S(e,r),r&&_(s),S(i,r)}}}class bt extends I{constructor(e){super(),D(this,e,null,vt,L,{})}}function $t(t){let e,s,i,c,r,d,a,n,o;return{c(){e=b("h2"),e.textContent="\u30EB\u30FC\u30E0",s=$(),i=b("input"),c=$(),r=b("button"),r.textContent="\u5165\u5BA4\u3059\u308B",d=$(),a=b("button"),a.textContent="\u30EB\u30FC\u30E0ID\u751F\u6210",H(i,"type","text"),H(i,"placeholder","\u30EB\u30FC\u30E0ID\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044"),H(i,"class","svelte-gzebfg")},m(u,l){p(u,e,l),p(u,s,l),p(u,i,l),Ce(i,t[0]),p(u,c,l),p(u,r,l),p(u,d,l),p(u,a,l),n||(o=[W(i,"input",t[3]),W(r,"click",t[2]),W(a,"click",t[1])],n=!0)},p(u,[l]){l&1&&i.value!==u[0]&&Ce(i,u[0])},i:m,o:m,d(u){u&&_(e),u&&_(s),u&&_(i),u&&_(c),u&&_(r),u&&_(d),u&&_(a),n=!1,N(o)}}}function Ct(t,e,s){let i="";function c(){s(0,i=He());var a="text/plain",n=new Blob([i],{type:a}),o=[new window.ClipboardItem({[a]:n})];navigator.clipboard.write(o).then(function(){},function(){})}function r(){if(i===""){alert("\u30EB\u30FC\u30E0ID\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044!");return}Q(`/room/${i}`)}function d(){i=this.value,s(0,i)}return[i,c,r,d]}class xt extends I{constructor(e){super(),D(this,e,Ct,$t,L,{})}}function kt(t){let e,s,i,c,r,d,a;return{c(){e=b("h2"),e.textContent="\u30AB\u30E1\u30E9\u30FB\u30DE\u30A4\u30AF\u30C1\u30A7\u30C3\u30AF",s=$(),i=b("button"),i.textContent="\u30AB\u30E1\u30E9\u30FB\u30DE\u30A4\u30AF\u30C1\u30A7\u30C3\u30AF",c=$(),r=b("p"),r.textContent="\u203B\u30DE\u30A4\u30AF\u304C\u30B9\u30D4\u30FC\u30AB\u30FC\u97F3\u3092\u62FE\u3046\u3068\u3001\u30CF\u30A6\u30EA\u30F3\u30B0\u3059\u308B\u5834\u5408\u304C\u3042\u308A\u307E\u3059\u3002\u305D\u306E\u5834\u5408\u306F\u4E00\u5EA6\u9000\u5BA4\u3057\u3001\u30B9\u30D4\u30FC\u30AB\u30FC\u97F3\u3092\u5C11\u3057\u843D\u3068\u3057\u305F\u4E0A\u3067\u518D\u5EA6\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002"},m(n,o){p(n,e,o),p(n,s,o),p(n,i,o),p(n,c,o),p(n,r,o),d||(a=W(i,"click",t[0]),d=!0)},p:m,i:m,o:m,d(n){n&&_(e),n&&_(s),n&&_(i),n&&_(c),n&&_(r),d=!1,a()}}}function Et(t){return[()=>Q("/checker")]}class St extends I{constructor(e){super(),D(this,e,Et,kt,L,{})}}const Ot="0.0.3";var Lt={value:Ot};function Rt(t){let e,s,i,c,r,d,a,n;return{c(){e=b("h2"),e.textContent="\u6280\u8853\u60C5\u5831",s=$(),i=b("ul"),c=b("li"),c.innerHTML=`Signaling Server \u306B
    <a href="https://ayame-labo.shiguredo.app/" target="_blank">Ayame Labo</a>
    \u3092\u5229\u7528\u3057\u3066\u3044\u307E\u3059\u3002`,r=$(),d=b("li"),d.innerHTML=`\u300COne on One in \u65E5\u672C\u300D\u306E\u30BD\u30FC\u30B9\u30B3\u30FC\u30C9\u306F
    <a href="https://github.com/ampcpmgp/one-on-one" target="_blank">\u3053\u3061\u3089</a>`,a=$(),n=b("li"),n.textContent=`v${Lt.value}`},m(o,u){p(o,e,u),p(o,s,u),p(o,i,u),M(i,c),M(i,r),M(i,d),M(i,a),M(i,n)},p:m,i:m,o:m,d(o){o&&_(e),o&&_(s),o&&_(i)}}}class Dt extends I{constructor(e){super(),D(this,e,null,Rt,L,{})}}function It(t){let e,s,i;return{c(){e=b("h2"),e.textContent="\u4F7F\u3044\u65B9",s=$(),i=b("ul"),i.innerHTML=`<li>\u307E\u305A\u306F\u300C\u30AB\u30E1\u30E9\u30FB\u30DE\u30A4\u30AF\u30C1\u30A7\u30C3\u30AF\u300D\u304B\u3089\u3001\u81EA\u62E0\u70B9\u306E\u6620\u50CF\u3068\u97F3\u58F0\u3092\u78BA\u8A8D\u3092\u3057\u3066\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u78BA\u8A8D\u304C\u7D42\u308F\u308A\u307E\u3057\u305F\u3089\u3001\u300C\u30EB\u30FC\u30E0\u300D\u3088\u308A\u3001\u30EB\u30FC\u30E0ID\u3092\u751F\u6210\u3057\u3066\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u30EB\u30FC\u30E0ID\u751F\u6210\u5F8C\u3001\u30AF\u30EA\u30C3\u30D7\u30DC\u30FC\u30C9\u306BID\u304C\u30B3\u30D4\u30FC\u3055\u308C\u307E\u3059\u3002\u305D\u306EID\u3092\u76F8\u624B\u306B\u304A\u4F1D\u3048\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u53D7\u3051\u53D6\u3063\u305F\u65B9\u306F\u30EB\u30FC\u30E0ID\u3092\u30C6\u30AD\u30B9\u30C8\u6B04\u306B\u5165\u529B\u3057\u3001\u300C\u5165\u5BA4\u3059\u308B\u300D\u30DC\u30BF\u30F3\u3092\u62BC\u3057\u3066\u304F\u3060\u3055\u3044\u3002</li> 
  <li>\u304A\u4E92\u3044\u304C\u5165\u5BA4\u3059\u308B\u3068\u30D3\u30C7\u30AA\u901A\u8A71\u304C\u53EF\u80FD\u306B\u306A\u308A\u307E\u3059\u3002</li>`},m(c,r){p(c,e,r),p(c,s,r),p(c,i,r)},p:m,i:m,o:m,d(c){c&&_(e),c&&_(s),c&&_(i)}}}class Tt extends I{constructor(e){super(),D(this,e,null,It,L,{})}}function At(t){let e,s,i;return{c(){e=b("h2"),e.textContent="\u6982\u8981",s=$(),i=b("ul"),i.innerHTML=`<li>\u3053\u306E\u30A2\u30D7\u30EA\u306F 1:1 \u5C02\u7528\u306E\u30D3\u30C7\u30AA\u901A\u8A71\u30A2\u30D7\u30EA\u3067\u3059\u3002</li> 
  <li>\u65E5\u672C\u56FD\u5916\u304B\u3089\u306F\u3054\u5229\u7528\u3067\u304D\u307E\u305B\u3093\u3002</li> 
  <li>\u540C\u50DA\u3084\u53CB\u4EBA\u3068\u304A\u4F7F\u3044\u304F\u3060\u3055\u3044\u3002\u4E0D\u7279\u5B9A\u591A\u6570\u3068\u7E4B\u304C\u308B\u3053\u3068\u306F\u3067\u304D\u307E\u305B\u3093\u3002</li>`},m(c,r){p(c,e,r),p(c,s,r),p(c,i,r)},p:m,i:m,o:m,d(c){c&&_(e),c&&_(s),c&&_(i)}}}class Pt extends I{constructor(e){super(),D(this,e,null,At,L,{})}}function jt(t){let e,s,i,c,r,d,a,n,o,u;return e=new Pt({}),i=new Tt({}),r=new St({}),a=new xt({}),o=new Dt({}),{c(){O(e.$$.fragment),s=$(),O(i.$$.fragment),c=$(),O(r.$$.fragment),d=$(),O(a.$$.fragment),n=$(),O(o.$$.fragment)},m(l,f){E(e,l,f),p(l,s,f),E(i,l,f),p(l,c,f),E(r,l,f),p(l,d,f),E(a,l,f),p(l,n,f),E(o,l,f),u=!0},p:m,i(l){u||(x(e.$$.fragment,l),x(i.$$.fragment,l),x(r.$$.fragment,l),x(a.$$.fragment,l),x(o.$$.fragment,l),u=!0)},o(l){k(e.$$.fragment,l),k(i.$$.fragment,l),k(r.$$.fragment,l),k(a.$$.fragment,l),k(o.$$.fragment,l),u=!1},d(l){S(e,l),l&&_(s),S(i,l),l&&_(c),S(r,l),l&&_(d),S(a,l),l&&_(n),S(o,l)}}}class Mt extends I{constructor(e){super(),D(this,e,null,jt,L,{})}}function Nt(t){let e,s,i,c;return e=new ge({}),i=new Mt({}),{c(){O(e.$$.fragment),s=$(),O(i.$$.fragment)},m(r,d){E(e,r,d),p(r,s,d),E(i,r,d),c=!0},p:m,i(r){c||(x(e.$$.fragment,r),x(i.$$.fragment,r),c=!0)},o(r){k(e.$$.fragment,r),k(i.$$.fragment,r),c=!1},d(r){S(e,r),r&&_(s),S(i,r)}}}class Ut extends I{constructor(e){super(),D(this,e,null,Nt,L,{})}}function Wt(t){let e;return{c(){e=b("p"),e.textContent="404"},m(s,i){p(s,e,i)},p:m,i:m,o:m,d(s){s&&_(e)}}}class Ht extends I{constructor(e){super(),D(this,e,null,Wt,L,{})}}function Vt(t){let e,s,i,c,r,d,a,n,o,u,l;return{c(){e=b("div"),s=b("video"),c=$(),r=b("video"),a=$(),n=b("div"),o=b("button"),o.textContent="\u9000\u5BA4\u3059\u308B",s.muted=!0,s.autoplay=!0,s.playsInline=!0,H(s,"class","svelte-1eo6cx9"),r.autoplay=!0,r.playsInline=!0,H(r,"class","svelte-1eo6cx9"),H(e,"class","videos svelte-1eo6cx9")},m(f,h){p(f,e,h),M(e,s),M(e,c),M(e,r),p(f,a,h),p(f,n,h),M(n,o),u||(l=[re(i=fe.call(null,s,t[0])),re(d=fe.call(null,r,t[1])),W(o,"click",t[2])],u=!0)},p(f,[h]){i&&z(i.update)&&h&1&&i.update.call(null,f[0]),d&&z(d.update)&&h&2&&d.update.call(null,f[1])},i:m,o:m,d(f){f&&_(e),f&&_(a),f&&_(n),u=!1,N(l)}}}function zt(t,e,s){let i,c;oe(t,Z,a=>s(0,i=a)),oe(t,ze,a=>s(1,c=a));let{params:r={}}=e;Ie(()=>{Fe(r.id)});function d(){qe(),Q("/")}return t.$$set=a=>{"params"in a&&s(3,r=a.params)},[i,c,d,r]}class qt extends I{constructor(e){super(),D(this,e,zt,Vt,L,{params:3})}}function Ft(t){let e,s,i,c;return e=new ge({}),i=new qt({}),{c(){O(e.$$.fragment),s=$(),O(i.$$.fragment)},m(r,d){E(e,r,d),p(r,s,d),E(i,r,d),c=!0},p:m,i(r){c||(x(e.$$.fragment,r),x(i.$$.fragment,r),c=!0)},o(r){k(e.$$.fragment,r),k(i.$$.fragment,r),c=!1},d(r){S(e,r),r&&_(s),S(i,r)}}}class Yt extends I{constructor(e){super(),D(this,e,null,Ft,L,{})}}var Gt={"/":Ut,"/checker":bt,"/room/:id":Yt,"*":Ht};function Jt(t){let e,s;return e=new ft({props:{routes:Gt}}),{c(){O(e.$$.fragment)},m(i,c){E(e,i,c),s=!0},p:m,i(i){s||(x(e.$$.fragment,i),s=!0)},o(i){k(e.$$.fragment,i),s=!1},d(i){S(e,i)}}}class Xt extends I{constructor(e){super(),D(this,e,null,Jt,L,{})}}new Xt({target:document.body});
